<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Some tips and notes need to write here.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yao He's Awesome Site (old posts, page 1) | Yao He's Awesome Site</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://stephen0921.github.io/index-1.html">
<link rel="prev" href="index-2.html" type="text/html">
<!--[if lt IE 9]>
            <script src="assets/js/html5shiv.min.js"></script>
            <script src="assets/js/respond.min.js"></script>
        <![endif]-->
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar  header-panel shadow-z-3" role="navigation"><div class="container-fluid">
        <div class="row">
          <div class="col-xs-3">
            <h1 class="title-blog">
                <a href="https://stephen0921.github.io/">
                        <span id="blog-title">Yao He's Awesome Site</span>
                    </a>
            </h1>
          </div>
          <div class="col-xs-9">
            <a id="hamburger" class="btn btn-raised" href="javascript:void(0);" onclick="menuToggle();">☰</a>
          </div>
        </div>
      </div>
<!-- /.container-fluid -->
</nav><div class="container-fluid main" id="content" role="main">
        <div class="row">
            <nav class="col-xs-12 col-sm-3 menu"><ul>
<li class="withripple"><a href="archive.html">Archive</a></li>
                <li class="withripple"><a href="categories/">Tags</a></li>
                <li class="withripple"><a href="rss.xml">RSS feed</a></li>

                    
                </ul>
<ul></ul></nav><div class="posts-material col-xs-12 col-sm-9">
                <div class="col-xs-12 col-md-11 content-material">

    <div class="postindex well post-material ">
    
        <article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/uvm-source-code-editor/" class="u-url">Study UVM Source Code with Sublime3</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/uvm-source-code-editor/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-06-15T13:17:25-04:00" title="2017-06-15 13:17">2017-06-15 13:17</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/uvm-source-code-editor/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/uvm-source-code-editor.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/uvm-source-code-editor.html";
var idcomments_post_url = "/posts/uvm-source-code-editor/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">UVM和Sublime3</h2>
<div class="outline-text-2" id="text-1">
<p>
学习UVM的很好的一个方法是读源码，去网上下载<a href="http://www.accellera.org/downloads/standards/uvm">UVM</a> 源码，然后就可以了。
很多主流的编辑器，对systemverilog的支持都很一般，我这里推荐使用 <a href="http://www.sublimetext.com/3">sublime3</a>。
但是首先需要安装一个插件管理器 <a href="https://packagecontrol.io/">packagecontrol</a> 。
之后，ctrol+shift+p，选择命令PackageControl:install package，搜索关键字systemverilog，安装好后，就大功告成了。
打开sublime3，然后在菜单栏里选择File-&gt;open folder，打开UVM的源码目录，好了开工。
</p>

<img src="images/uvm_driver.png" class="img-thumbnail" width="60%"><p>
比如我看到下面这行代码，想看看uvm component的定义，那就在uvm component的位置上按F12。
</p>
<div class="highlight"><pre><span></span>class uvm_driver #(type REQ=uvm_sequence_item,
		     type RSP=REQ) extends uvm_component;
</pre></div>
<p>
我们就能找到它的位置了，如下图所示。
</p>

<img src="images/uvm_comp.png" class="img-thumbnail" width="60%">
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/edaplayground-intro/" class="u-url">Edaplayground Introduction</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/edaplayground-intro/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-06-09T13:16:05-04:00" title="2017-06-09 13:16">2017-06-09 13:16</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/edaplayground-intro/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/edaplayground-intro.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/edaplayground-intro.html";
var idcomments_post_url = "/posts/edaplayground-intro/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">免费的仿真器</h2>
<div class="outline-text-2" id="text-1">
<p>
如果你能访问google的话，大概也就能访问<a href="https://www.edaplayground.com/">edaplayground</a> 。很多的情况下，我想试写一些验证代码，但是个人PC上没有仿真器，那么edaplayground就派上用场了。最好是登录使用，这样可以保存代码了，以便将来再调试。当然也可以使用google账户或者facebook账户。
</p>

<p>
自己编辑过的代码，可以share给别人来看。
<a href="http://www.edaplayground.com/x/5xF7">my simple test</a>
</p>

<img src="images/edaplayground.png" class="img-thumbnail" width="60%"><p>
可以看到，左边的选项里，我们可以选择语言、UVM/OVM库、仿真器种类，基本满足日常的简单环境和case的调试。还有很多很多代码例子，我们不用从头去搭建。
</p>

<img src="images/edaplaygroundexample.png" class="img-thumbnail" width="60%"><p>
我们选择一个example，然后点击左上角的run，是不是很容易啊？
</p>

<img src="images/edaplaygroundrun.png" class="img-thumbnail" width="60%"><p>
另外，推荐一个使用edaplayground来学习UVM的网站，<a href="http://cluelogic.com/category/uvm/">这个</a> 真的是很详细，很容易上手！
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/xxnet-intro/" class="u-url">XX Net Introduction</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/xxnet-intro/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-06-06T13:07:19-04:00" title="2017-06-06 13:07">2017-06-06 13:07</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/xxnet-intro/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/xxnet-intro.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/xxnet-intro.html";
var idcomments_post_url = "/posts/xxnet-intro/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">能上google非常重要</h2>
<div class="outline-text-2" id="text-1">
<p>
比如我们分别在baidu和goolge上搜索systemverilog。
百度的结果：
</p>

<img src="images/baidusv.png" class="img-thumbnail" width="60%"><p>
google的结果：
</p>

<img src="images/googlesv.png" class="img-thumbnail" width="60%"><p>
可以看出来，虽然都能搜到IC领域的systemverilog的介绍，但是baidu的结果一般是别人的一些经验总结，比较碎片化，主要是中文内容，初级的解释为主。对比来看，google的结果是，wiki上的详细介绍和语言标准的权威网站链接。当我们不再是systemverilog的初学者，显然google的结果对我们IC从业者的帮助更大。
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">通过xx-net上google</h2>
<div class="outline-text-2" id="text-2">
<p>
有很多商业化的VPN工具可以做到这一点，这里我不做介绍。我只来提一下一个免费版本，那就是xx-net。xx-net是一个开源的项目，其代码托管在github上，<a href="https://github.com/XX-net/XX-Net">这个是连接</a> 。上面有详细的介绍，和使用配置说明，提醒一句，使用xx-net的时候，最好不要挂QQ以及使用网银，安全考虑。
顺利的话，就可以访问真正的互联网了。
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-04-02-perl-overview/" class="u-url">Perl Overview</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-04-02-perl-overview/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-04-02T18:35:15+08:00" title="2017-04-02 18:35">2017-04-02 18:35</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/2017-04-02-perl-overview/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/2017-04-02-perl-overview.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/2017-04-02-perl-overview.html";
var idcomments_post_url = "/posts/2017-04-02-perl-overview/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Perl coding tips</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1">打开pipe或者访问文件的时候，最好使用die</h3>
<div class="outline-text-3" id="text-1-1">
<div class="highlight"><pre><span></span><span class="nb">open</span> <span class="n">FILE</span><span class="p">,</span> <span class="s">"a_file"</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">"Can not open file a_file: $!"</span><span class="p">;</span>
<span class="nb">close</span> <span class="n">FILE</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2">比die更好用的是croak</h3>
<div class="outline-text-3" id="text-1-2">
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">Carp</span><span class="p">;</span>
<span class="n">a</span><span class="p">(</span><span class="s">"a_file"</span><span class="p">);</span> <span class="c1">#resume that a_file does exist</span>
<span class="n">a</span><span class="p">(</span><span class="s">"b_file"</span><span class="p">);</span> <span class="c1">#resume that b_file does not exist</span>
<span class="k">sub</span> <span class="nf">a</span> <span class="p">{</span>
      <span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
      <span class="nb">open</span> <span class="n">FILE</span><span class="p">,</span> <span class="s">"$filename"</span> <span class="ow">or</span> <span class="n">croak</span> <span class="s">"Can not open file $filename: $!"</span><span class="p">;</span>
      <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3">用dumper来print复杂的数据结构，便于debug</h3>
<div class="outline-text-3" id="text-1-3">
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">Data::Dumper</span><span class="p">;</span>

<span class="nv">$var</span> <span class="o">=</span> <span class="p">{</span><span class="s">"name"</span> <span class="o">=&gt;</span> <span class="s">"hello"</span><span class="p">,</span> <span class="s">"action"</span> <span class="o">=&gt;</span> <span class="s">"speak"</span> <span class="p">};</span>
<span class="k">print</span> <span class="n">Dumper</span><span class="p">(</span><span class="nv">$var</span><span class="p">);</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4">用grep和map可以节省很多代码</h3>
<div class="outline-text-3" id="text-1-4">
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">@foos</span> <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span><span class="o">!</span><span class="sr">/^#/</span><span class="p">}</span> <span class="nv">@bars</span><span class="p">;</span>    <span class="c1"># weed out comments</span>

<span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span>  <span class="nb">lc</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="mi">1</span>  <span class="p">}</span> <span class="nv">@array</span>

<span class="k">my</span> <span class="nv">@squares</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">*</span> <span class="nv">$_</span> <span class="p">}</span> <span class="nb">grep</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">}</span> <span class="nv">@numbers</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5">使用qq代替双引号，使用q代替单引号，list赋值使用qw</h3>
<div class="outline-text-3" id="text-1-5">
<div class="highlight"><pre><span></span><span class="nv">$a</span> <span class="o">=</span> <span class="sx">qq{"}</span><span class="p">;</span> <span class="c1">#{} is used for boundary</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="sx">qq!"!</span><span class="p">;</span> <span class="c1">#!! is the same</span>

<span class="nv">$c</span> <span class="o">=</span> <span class="sx">q{'}</span><span class="p">;</span>
<span class="nv">@vars</span> <span class="o">=</span> <span class="sx">qw{a b c}</span><span class="p">;</span>
</pre></div>
</div>
</div>


<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6">使用list的内置函数，不要重新发明轮子</h3>
<div class="outline-text-3" id="text-1-6">
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">List::Util</span> <span class="sx">qw(max)</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@vars</span> <span class="o">=</span> <span class="sx">qw(1 2 3)</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="nv">@vars</span><span class="p">);</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7">打印多行的信息</h3>
<div class="outline-text-3" id="text-1-7">
<div class="highlight"><pre><span></span><span class="nv">$a</span> <span class="o">=</span> <span class="s">"hello"</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&lt;&lt;</span><span class="dl">ENDOFPRINT</span><span class="s">;</span>
<span class="s">Dear Lee,</span>
<span class="s">    blablabla...</span>
<span class="s">    $a</span>
<span class="dl">ENDOFPRINT</span>

<span class="nv">$b</span> <span class="o">=</span> <span class="s">&lt;&lt;</span><span class="dl">ENDOFA</span><span class="s">;</span>
<span class="s">Dear friend,</span>
<span class="s">   I am here.</span>
<span class="dl">ENDOFA</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8">只想做语法检查</h3>
<div class="outline-text-3" id="text-1-8">
<div class="highlight"><pre><span></span>perl -cwT test.pl
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9">查看Perl默认的include路径</h3>
<div class="outline-text-3" id="text-1-9">
<div class="highlight"><pre><span></span>perl -e <span class="s2">"print join(qq{\n}, @INC);"</span>
</pre></div>
</div>
</div>


<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10">使用自己的local路径下的库</h3>
<div class="outline-text-3" id="text-1-10">
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">lib</span> <span class="s">'/home/xx/eda_scripts/pm'</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11">查看perl的pod格式的说明</h3>
<div class="outline-text-3" id="text-1-11">
<div class="highlight"><pre><span></span>perldoc rvp.pm
perldoc perldoc
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12">Perl5.8之后的版本，可以在数据中间加下划线</h3>
<div class="outline-text-3" id="text-1-12">
<div class="highlight"><pre><span></span><span class="nv">$a</span> <span class="o">=</span> <span class="mi">111_222</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"a = "</span><span class="p">,</span> <span class="nv">$a</span> <span class="p">,</span> <span class="s">"\n"</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13">调用其他shell命令，同时获得shell命令的STDERR以及STDOUT信息</h3>
<div class="outline-text-3" id="text-1-13">
<div class="highlight"><pre><span></span><span class="nv">$pid</span> <span class="o">=</span> <span class="nb">open</span> <span class="nv">$readme</span><span class="p">,</span> <span class="s">"-|"</span><span class="p">,</span> <span class="s">"$cmd 2&gt;&amp;1"</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="sr">&lt;$readme&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">push</span><span class="p">(</span><span class="nv">@out</span><span class="p">,</span> <span class="nv">$_</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">close</span> <span class="nv">$readme</span><span class="p">;</span>
</pre></div>
</div>
</div>


<div id="outline-container-sec-1-14" class="outline-3">
<h3 id="sec-1-14">Perl使用子线程，获得子线程的STDERR信息</h3>
<div class="outline-text-3" id="text-1-14">
<div class="highlight"><pre><span></span><span class="nb">pipe</span><span class="p">(</span><span class="n">READER</span><span class="p">,</span> <span class="n">WRITER</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">"pipe no good: $!"</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">fork</span><span class="p">();</span>
<span class="nb">die</span> <span class="s">"Can no fork: $!"</span> <span class="k">unless</span> <span class="nb">defined</span> <span class="nv">$pid</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span> <span class="c1">#parent process</span>
    <span class="nb">close</span> <span class="n">WRITER</span><span class="p">;</span>
    <span class="k">while</span><span class="p">(</span><span class="sr">&lt;READER&gt;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nb">push</span> <span class="nv">@out</span><span class="p">,</span> <span class="nv">$_</span><span class="p">;</span>
    <span class="p">}</span>    
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span> <span class="c1">#child process</span>
    <span class="nb">close</span> <span class="n">READER</span><span class="p">;</span>
    <span class="nb">open</span> <span class="bp">STDERR</span><span class="p">,</span> <span class="s">"&gt;&amp;WRITER"</span><span class="p">;</span>
    <span class="nv">$parser</span> <span class="o">=</span> <span class="nn">XML::LibXML</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">;</span>
    <span class="nv">$parser</span><span class="o">-&gt;</span><span class="n">validation</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="nb">exit</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-15" class="outline-3">
<h3 id="sec-1-15">多线程</h3>
<div class="outline-text-3" id="text-1-15">
</div>
<div id="outline-container-sec-1-15-1" class="outline-4">
<h4 id="sec-1-15-1">因为fork是复制出一个完全一样的进程，所以“go on”会被print 2 次。</h4>
<div class="outline-text-4" id="text-1-15-1">
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">fork</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#parent</span>
    <span class="k">print</span> <span class="s">"in parent\n"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1">#child</span>
    <span class="k">print</span> <span class="s">"in child\n"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">print</span> <span class="s">"go on\n"</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-15-2" class="outline-4">
<h4 id="sec-1-15-2">child process中途退出了，所以 “go on”只被print 1次</h4>
<div class="outline-text-4" id="text-1-15-2">
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">fork</span><span class="p">();</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#parent</span>
    <span class="k">print</span> <span class="s">"in parent\n"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1">#child</span>
    <span class="k">print</span> <span class="s">"in child\n"</span><span class="p">;</span>
    <span class="nb">exit</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">print</span> <span class="s">"go on\n"</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-15-3" class="outline-4">
<h4 id="sec-1-15-3">child process通过exec，替换掉当前process，所以 “never print this”不会被print</h4>
<div class="outline-text-4" id="text-1-15-3">
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$pid</span> <span class="o">=</span> <span class="nb">fork</span><span class="p">();</span>

<span class="k">if</span><span class="p">(</span><span class="nv">$pid</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">#parent</span>
    <span class="k">print</span> <span class="s">"in parent\n"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="c1">#child</span>
    <span class="k">print</span> <span class="s">"in child\n"</span><span class="p">;</span>
    <span class="nb">exec</span><span class="p">(</span><span class="s">"ls"</span><span class="p">);</span>
    <span class="k">print</span> <span class="s">"never print this.\n"</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">print</span> <span class="s">"go on\n"</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-15-4" class="outline-4">
<h4 id="sec-1-15-4">eval{}是一种保护性写法。eval的运行结果放在$@里。可以结合alarm handler来完成很多应用</h4>
<div class="outline-text-4" id="text-1-15-4">
<div class="highlight"><pre><span></span><span class="k">print</span> <span class="bp">STDERR</span> <span class="s">"type your password: "</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$password</span> <span class="o">=</span>
<span class="nb">eval</span> <span class="p">{</span>
<span class="nb">local</span> <span class="nv">$SIG</span><span class="p">{</span><span class="n">ALRM</span><span class="p">}</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">die</span> <span class="s">"timeout\n"</span> <span class="p">};</span>
<span class="nb">alarm</span> <span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="c1"># five second timeout</span>
<span class="k">return</span> <span class="sr">&lt;STDIN&gt;</span><span class="p">;</span>
<span class="p">};</span>
<span class="nb">alarm</span> <span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">print</span> <span class="bp">STDERR</span> <span class="s">"you timed out\n"</span> <span class="k">if</span> <span class="vg">$@</span> <span class="o">=~</span><span class="sr"> /timeout/</span><span class="p">;</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-15-5" class="outline-4">
<h4 id="sec-1-15-5">reaper函数，非阻塞式（WNOHANG）的处理所有子进程，$kid等于-1的时候，表示没有需要回收的进程，跳出reaper函数</h4>
<div class="outline-text-4" id="text-1-15-5">
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">POSIX</span> <span class="s">'WNOHANG'</span><span class="p">;</span>
<span class="nv">$SIG</span><span class="p">{</span><span class="n">CHLD</span><span class="p">}</span> <span class="o">=</span> <span class="o">\&amp;</span><span class="n">reaper</span><span class="p">;</span>
<span class="k">sub</span> <span class="nf">reaper</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">((</span><span class="k">my</span> <span class="nv">$kid</span> <span class="o">=</span> <span class="nb">waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">WNOHANG</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">warn</span> <span class="s">"Reaped child with PID $kid\n"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-sec-1-16" class="outline-3">
<h3 id="sec-1-16">reference</h3>
<div class="outline-text-3" id="text-1-16">
<p>
类似c语言的指针
</p>

<div class="highlight"><pre><span></span><span class="nv">@vars</span> <span class="o">=</span> <span class="p">();</span>
<span class="nv">$vars_ref</span> <span class="o">=</span> <span class="o">\</span><span class="nv">@vars</span><span class="p">;</span>

<span class="nv">$a_href</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nv">$b_href</span> <span class="o">=</span> <span class="p">{</span> <span class="s">"name"</span> <span class="o">=&gt;</span> <span class="s">"b"</span><span class="p">,</span> <span class="s">"action"</span> <span class="o">=&gt;</span> <span class="s">"speak"</span><span class="p">,</span> <span class="p">};</span>
<span class="nv">$c_href</span> <span class="o">=</span> <span class="p">{</span><span class="nv">%</span><span class="p">{</span><span class="nv">$b_href</span><span class="p">}};</span>


<span class="nv">$tmp</span> <span class="o">=</span> <span class="s">"name"</span><span class="p">;</span>
<span class="k">print</span> <span class="nv">$c_href</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$tmp</span><span class="p">},</span> <span class="s">"\n"</span><span class="p">;</span> <span class="c1">#This is called a symbolic reference</span>
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-17" class="outline-3">
<h3 id="sec-1-17">安装module</h3>
<div class="outline-text-3" id="text-1-17">
<div class="highlight"><pre><span></span>cpan install Template
cpan install XML::Rabbit
</pre></div>
</div>
</div>

<div id="outline-container-sec-1-18" class="outline-3">
<h3 id="sec-1-18">好用的module</h3>
<div class="outline-text-3" id="text-1-18">
<p>
<a href="http://template-toolkit.org/docs/">Template Toolkit</a>
</p>

<p>
<a href="http://search.cpan.org/~shlomif/XML-LibXML-2.0125/LibXML.pod">XML::LibXML</a>
</p>


<p>
<a href="http://search.cpan.org/~robins/XML-Rabbit-0.4.1/lib/XML/Rabbit.pm">XML::Rabbit</a>
</p>

<p>
<a href="http://www.burbleland.com/v2html/rvp.html">rvp</a>
</p>

<p>
<a href="http://search.cpan.org/~neilb/Smart-Comments-1.06/lib/Smart/Comments.pm">Smart::Comments</a>
</p>

<p>
<a href="http://search.cpan.org/~ether/Moose-2.1802/lib/Moose.pm">Moose</a>
</p>
</div>
</div>


<div id="outline-container-sec-1-19" class="outline-3">
<h3 id="sec-1-19">Perl 在验证中的应用</h3>
<div class="outline-text-3" id="text-1-19">
<p>
<a href="http://www.doulos.com/content/events/easierUVM.php">easier UVM</a>
</p>
</div>
</div>

<div id="outline-container-sec-1-20" class="outline-3">
<h3 id="sec-1-20">Perl 参考网站</h3>
<div class="outline-text-3" id="text-1-20">
<p>
<a href="http://perldoc.perl.org/">perldoc</a>
</p>

<p>
<a href="http://search.cpan.org/">cpan</a>
</p>
</div>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/fibonacci-intro/" class="u-url">Fibonacci Introduction</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/fibonacci-intro/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-03-24T13:06:01-04:00" title="2017-03-24 13:06">2017-03-24 13:06</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/fibonacci-intro/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/fibonacci-intro.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/fibonacci-intro.html";
var idcomments_post_url = "/posts/fibonacci-intro/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">有趣的Fibonacci数列</h2>
<div class="outline-text-2" id="text-1">
<div class="highlight"><pre><span></span><span class="m">0</span>,1,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987,1597,2584,4181,6765,10946,...
</pre></div>

<p>
这样的数字序列满足公式F<sub>n</sub> = F<sub>n-1</sub> + F<sub>n-2</sub>，其中F<sub>n</sub>表示第n个数字，这就是大名鼎鼎的<a href="http://www.mathsisfun.com/numbers/fibonacci-sequence.html">Fibonacci数列</a>。 
如果把每一个数字的当作正方形的边长，然后把这些正方形堆砌在一起，就可以绘制出美丽的螺旋曲线。
</p>

<img src="images/fibonacci-spiral.gif" class="img-thumbnail" width="60%"><p>
如果把这个序列变化成函数，比如系数依然满足F<sub>n</sub>(z) = F<sub>n-1</sub>(z) + F<sub>n-2</sub>(z)。也就是说这样的函数：
f(z)      = 0 + z + z<sup>2</sup> + 2z<sup>3</sup> + 3z<sup>4</sup> + 5z<sup>5</sup> + 8z<sup>6</sup> + …
</p>

<p>
那么我们能知道：
</p>

<p>
zf(z)     =     0 + z<sup>2</sup> + z<sup>3</sup>  + 2z<sup>4</sup> + 3z<sup>5</sup> + 5z<sup>5</sup> + …
</p>

<p>
z<sup>2</sup>f(z) =             0 + z<sup>3</sup>  +  z<sup>4</sup> + 2z<sup>5</sup> + 3z<sup>5</sup> + …
</p>

<p>
由此我们得到关系式：
</p>

<p>
f(z) = z + zf(z) + z<sup>2</sup>f(z)
</p>

<p>
进一步推导，
</p>

<img src="images/fibonacci.png" class="img-thumbnail" width="60%">
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/if-else-in-perl/" class="u-url">If Else in Perl</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/if-else-in-perl/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-03-20T13:04:49-04:00" title="2017-03-20 13:04">2017-03-20 13:04</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/if-else-in-perl/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/if-else-in-perl.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/if-else-in-perl.html";
var idcomments_post_url = "/posts/if-else-in-perl/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">If Else in Perl</h2>
<div class="outline-text-2" id="text-1">
<p>
if-elsif-else这样的语句在我们的code里再常见不过了。
</p>
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s">"John"</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">name_solute</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$ret</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="s">"Tom"</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$ret</span> <span class="o">=</span> <span class="s">"Hi Tom."</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="s">"Jerry"</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$ret</span> <span class="o">=</span> <span class="s">"Run! Run!"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">elsif</span> <span class="p">(</span><span class="nv">$item</span> <span class="ow">eq</span> <span class="s">"Lucy"</span><span class="p">)</span> <span class="p">{</span>
	<span class="nv">$ret</span> <span class="o">=</span> <span class="s">"Where is Lily?"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
	<span class="nv">$ret</span> <span class="o">=</span> <span class="s">"I do not know you."</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$solute</span> <span class="o">=</span> <span class="n">name_solute</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
</pre></div>

<p>
如果我们换一种方式，比如三元式，可能更好看一点。
</p>
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$solute</span> <span class="o">=</span> 
    <span class="nv">$name</span> <span class="ow">eq</span> <span class="s">"Tom"</span>   <span class="p">?</span>  <span class="s">"Hi Tom."</span>             <span class="p">:</span>
    <span class="nv">$name</span> <span class="ow">eq</span> <span class="s">"Jerry"</span> <span class="p">?</span>  <span class="s">"Run! Run!"</span>           <span class="p">:</span>
    <span class="nv">$name</span> <span class="ow">eq</span> <span class="s">"Lucy"</span>  <span class="p">?</span>  <span class="s">"Where is Lily?"</span>      <span class="p">:</span>
			<span class="s">"I do not know you."</span>  <span class="p">;</span>
</pre></div>

<p>
另外提一种比较好的数据结构，可以用来实现比较复杂的逻辑或者小环境。
</p>
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$ref_var</span> <span class="o">=</span> <span class="p">{</span>
     <span class="s">"name"</span>               <span class="o">=&gt;</span>  <span class="p">[</span><span class="o">[]</span><span class="p">,</span><span class="o">\&amp;</span><span class="n">name_proc</span><span class="p">]</span> <span class="p">,</span>
     <span class="s">"address"</span>            <span class="o">=&gt;</span>  <span class="p">[</span><span class="o">[]</span><span class="p">,</span><span class="o">\&amp;</span><span class="n">addr_proc</span><span class="p">]</span> <span class="p">,</span>
     <span class="s">"mail"</span>               <span class="o">=&gt;</span>  <span class="p">[</span><span class="o">[]</span><span class="p">,</span><span class="o">\&amp;</span><span class="n">mail_proc</span><span class="p">]</span> 
     <span class="p">};</span>

 <span class="nb">push</span><span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">},</span> <span class="s">"John Smith"</span><span class="p">);</span>
 <span class="nb">push</span><span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">address</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">},</span> <span class="s">"Beijing, China"</span><span class="p">);</span>
 <span class="nb">push</span><span class="p">(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">mail</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">},</span> <span class="s">"john\@gmail.com"</span><span class="p">);</span>

 <span class="o">&amp;</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">}(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="p">);</span>
 <span class="o">&amp;</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">address</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">}(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">address</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="p">);</span>
 <span class="o">&amp;</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">mail</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">}(</span> <span class="nv">@</span><span class="p">{</span> <span class="nv">$ref_var</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">mail</span><span class="p">}</span><span class="o">-&gt;</span><span class="p">[</span><span class="mi">0</span><span class="p">]}</span> <span class="p">);</span>

 <span class="k">sub</span> <span class="nf">name_proc</span> <span class="p">{</span>
     <span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
     <span class="k">print</span> <span class="s">"Hello, $item\n"</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="k">sub</span> <span class="nf">addr_proc</span> <span class="p">{</span>
     <span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
     <span class="k">print</span> <span class="s">"He lives in $item\n"</span><span class="p">;</span>
 <span class="p">}</span>

 <span class="k">sub</span> <span class="nf">mail_proc</span> <span class="p">{</span>
     <span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
     <span class="k">print</span> <span class="s">"You can contact to $item\n"</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>

<p>
首先，$ref-var是一个hash的<a href="https://perldoc.perl.org/perlreftut.html">reference</a> ，它的各个key所对应的都是一个list的reference。每一个list里面，又分成一个空的list的reference，用来存input变量，以及一个函数指针。这个结构不错呦，我也是从大神那搬过来的，O(∩<sub>∩</sub>)O哈哈~
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/makefile-basic/" class="u-url">Makefile Basic</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/makefile-basic/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-03-19T13:04:07-04:00" title="2017-03-19 13:04">2017-03-19 13:04</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/makefile-basic/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/makefile-basic.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/makefile-basic.html";
var idcomments_post_url = "/posts/makefile-basic/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Makefile</h2>
<div class="outline-text-2" id="text-1">
<p>
使用Makefile管理软件流程，轻松便利，但有一些基本的语法，总是忘记，写此博文，给将来的好忘的我。
直接上干货：
</p>
<div class="highlight"><pre><span></span><span class="cp">ifndef TEST_MK</span>
  <span class="k">$(</span>error enviornment variable TEST_MK should be set!<span class="k">)</span>
<span class="cp">endif</span>

<span class="nv">HHH</span><span class="o">?=</span><span class="m">1</span>

<span class="cp">ifeq ("$(HHH)","1")</span>
  <span class="nv">INFO</span><span class="o">=</span><span class="s2">"HHH is 1 by default"</span>
<span class="cp">else</span>
  <span class="nv">INFO</span><span class="o">=</span><span class="s2">"HHH is set to other value </span><span class="k">$(</span>HHH<span class="k">)</span><span class="s2">"</span>
<span class="cp">endif</span>

<span class="nf">compile</span><span class="o">:</span> <span class="n">gen_test</span>
<span class="cp">ifeq ("$HHH","1")</span>
	<span class="nv">INFO</span><span class="o">=</span><span class="k">$(</span>INFO<span class="k">)</span> perl test.pl
<span class="cp">else</span>
	<span class="nv">INFO</span><span class="o">=</span><span class="k">$(</span>INFO<span class="k">)</span> perl test.pl
<span class="cp">endif</span>

<span class="nf">gen_test</span><span class="o">:</span> <span class="n">clean</span>
	@echo <span class="s2">"my \$</span><span class="nv">$info</span><span class="s2"> = \$</span><span class="nv">$ENV</span><span class="s2">{'INFO'};print \"We get in perl: \$</span><span class="nv">$info</span><span class="s2">\\n\";print \"We can get TEST_MK!\\n\" if (defined \$</span><span class="nv">$ENV</span><span class="s2">{'TEST_MK'});"</span> &gt; test.pl

<span class="nf">clean</span><span class="o">:</span>
	rm -rf test.pl
</pre></div>

<p>
命令行输入：
</p>
<div class="highlight"><pre><span></span>setenv TEST_MK hello<span class="p">;</span>make
</pre></div>

<p>
结果是：
</p>
<div class="highlight"><pre><span></span>rm -rf test.pl
<span class="nv">INFO</span><span class="o">=</span><span class="s2">"HHH is 1 by default"</span> perl test.pl
We get in perl: HHH is <span class="m">1</span> by default
We can get TEST_MK!
</pre></div>

<p>
关键的点有下面几个：
</p>
<ul class="org-ul">
<li>对环境变量的判断，使用ifndef，同时用error来输出错误信息，并停止。
</li>
<li>使用“?=”来设置default值，如果想在命令行对变量“HHH”赋值：
</li>
</ul>
<div class="highlight"><pre><span></span>make <span class="nv">HHH</span><span class="o">=</span><span class="m">2</span>
</pre></div>
<ul class="org-ul">
<li>判断变量值用ifeq
</li>
<li>最重要的一点，Makefile和Perl天生八字不合，好好的“$”，在Makefile里要写成"\$$"，我也是醉了。
</li>
<li>一般的情况下，执行的命令都会显示出来，除非在前面加上“@”。
</li>
<li>“INFO=$(INFO) perl test.pl”表示的是，把环境变量INFO传到perl的命令里去。
</li>
</ul>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/code-gen/" class="u-url">Code Generation</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/code-gen/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-03-17T13:02:25-04:00" title="2017-03-17 13:02">2017-03-17 13:02</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/code-gen/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/code-gen.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/code-gen.html";
var idcomments_post_url = "/posts/code-gen/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Code Generation</h2>
<div class="outline-text-2" id="text-1">
<p>
生成代码或者小环境，我比较喜欢的方法，我总结如下。
</p>
<ul class="org-ul">
<li>用JSON格式文件控制输入变量
</li>
<li>使用Template Toolkit，控制展示出来的代码样式
</li>
</ul>
<p>
闲言少叙，我们举一个例子。
假设一个场景，我们需要根据很多简单的逻辑表达式，来生成一个verilog的module。
</p>

<p>
我们把这个任务划分成几部分考虑。
</p>
<ul class="org-ul">
<li>逻辑表达式需要怎么样的格式呢？
</li>
<li>需要哪些变量控制我们最后生成的module的样式？
</li>
<li>用怎么样的方式，把这个流程串起来，同时能便于以后的维护呢？逻辑表达式的变化，要可以重新生成代码，同时不需要手动去修改。
</li>
</ul>
<p>
第一个问题，逻辑表达式需要怎么样的格式？因为我对Emacs比较情有独钟，恰好我觉得使用<a href="http://orgmode.org">org-mode</a> 来书写简单的组合逻辑特别合适。先看一下下面的贴图感受一下。 
</p>

<img src="images/org.png" class="img-thumbnail" width="60%"><p>
上图是Emacs编辑器显示出来的，其实里面纯文本，是这样的：
</p>

<img src="images/org_text.png" class="img-thumbnail" width="60%"><p>
处理这个不是很复杂，可以看作对树形节点的处理。
</p>

<p>
第二个问题，需要哪些变量控制我们最后生成的module的样式？我想到的有这么几个变量，我用JSON格式写出来：
</p>
<div class="highlight"><pre><span></span>{
    "prefix_name":"demo",
    "org_file":"doc/demo.org",
    "outputs":"ap_disp_light_sleep_req,ap_light_sleep_req"
}
</pre></div>
<p>
可能你会说，其实可以通过命令行的option来把变量加进去一下，比如：
</p>
<div class="highlight"><pre><span></span>run.pl -prefix_name demo -org_file doc/demo.org -outputs ap_disp_light_sleep_req,ap_light_sleep_req
</pre></div>
<p>
确实可以，但是这样我们的脚本对于option的处理不灵活，如果以后加的option更多，我们的命令也就越来越长。
</p>

<p>
第三个问题，用怎么样的方式，把这个流程串起来，同时能便于以后的维护呢？这就是核心了，Perl脚本来做这些工作。
</p>
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">JSON</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Template</span><span class="p">;</span>
<span class="o">...</span>
<span class="k">sub</span> <span class="nf">read_json</span> <span class="p">{</span>
<span class="o">...</span>
<span class="p">}</span>
<span class="k">sub</span> <span class="nf">template_proc</span> <span class="p">{</span>
<span class="o">...</span>
<span class="p">}</span>
</pre></div>

<p>
我们的模板文件其实，比较简单：
</p>
<div class="highlight"><pre><span></span>module [% prefix_name %]_ref_model (
[%- FOREACH item IN inputs.sort %]
  input [% item %],
[%- END %]
[%- cnt =0 -%]
[%- total_cnt = outputs.size %]
[%- FOREACH item IN outputs.sort %]
  [%- cnt = cnt + 1 %]
  [%- IF (cnt == total_cnt) %]
  output wire [% item %]
  [%- ELSE %]
  output wire [% item %],
  [%- END%]
[%- END %]
);
[%- FOREACH item IN wires.sort %]
  wire [% item %];
[%- END %]

[%- FOREACH item IN lines_info_ref %]
  [%- IF (item.leafs.size == 0) %]
  [%- ELSE %]
  assign [% item.name %] = [% item.contents.join(' ') %];
  [%- END %]
[%- END %]
endmodule
</pre></div>

<p>
<a href="https://github.com/stephen0921/org_verilog/blob/master/bin/org_verilog.pl">perl的源代码可以来这里找</a> 。Enjoy yourself!
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/perl-template/" class="u-url">Perl Template</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/perl-template/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-03-13T12:58:29-04:00" title="2017-03-13 12:58">2017-03-13 12:58</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/perl-template/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/perl-template.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/perl-template.html";
var idcomments_post_url = "/posts/perl-template/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">关于print的一些事</h2>
<div class="outline-text-2" id="text-1">
<p>
某一些情况下，我们想要根据一些变量，然后生成一大段文本或者是代码。比较直接的代码风格就是：
</p>
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s">"John"</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$day</span> <span class="o">=</span> <span class="s">"Friday"</span><span class="p">;</span>

<span class="k">print</span> <span class="s">"Dear $name,\n"</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"Please come to my office on $day.\n"</span><span class="p">;</span>
</pre></div>

<p>
幸好，我们还可以少打一些“print”，如果我们这样来写：
</p>
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="s">"John"</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$day</span> <span class="o">=</span> <span class="s">"Friday"</span><span class="p">;</span>

<span class="k">print</span> <span class="s">&lt;&lt;</span><span class="dl">END</span><span class="s">;</span>
<span class="s">Dear $name,</span>
<span class="s">Please come to my office on $day.</span>
<span class="dl">END</span>
</pre></div>

<p>
如果文本的内容更多，那么在我们的脚本里就会出现需要“print”的大段信息，不如我们单独把这些信息放到另外一个文件里，我们管它叫模板文件,比如“letter.tt”：
</p>
<div class="highlight"><pre><span></span>Dear [% name %],
Please come to my office on [% day %].
</pre></div>

<p>
然后，我们在我们的Perl脚本里去处理这个模板，然后最后输出到“letter.txt”中：
</p>
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">Template</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Cwd</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$dir</span> <span class="o">=</span> <span class="n">cwd</span><span class="p">();</span>
<span class="k">my</span> <span class="nv">$config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">INCLUDE_PATH</span> <span class="o">=&gt;</span> <span class="nv">$dir</span>
<span class="p">};</span>

<span class="k">my</span> <span class="nv">$tpl_name</span> <span class="o">=</span> <span class="s">"letter.tt"</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$tpl</span> <span class="o">=</span> <span class="nn">Template</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
<span class="nb">chdir</span><span class="p">(</span><span class="nv">$dir</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$var_ref</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">name</span> <span class="o">=&gt;</span> <span class="s">"John"</span><span class="p">,</span>
    <span class="n">day</span>  <span class="o">=&gt;</span> <span class="s">"Friday"</span>
<span class="p">};</span>

<span class="k">my</span> <span class="nv">$out_file</span> <span class="o">=</span> <span class="s">"letter.txt"</span><span class="p">;</span>

<span class="nv">$tpl</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="s">"$tpl_name"</span><span class="p">,</span> <span class="nv">$var_ref</span><span class="p">,</span> <span class="s">"$dir/$out_file"</span><span class="p">)</span> <span class="o">||</span> <span class="nb">die</span> <span class="nv">$tpl</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">();</span>
</pre></div>
<p>
把模板代码单独放到另外一个文件，便于以后的维护。即使维护的人，不懂Perl，但是模板本身具有极强的易读性。更多关于Template Toolkit的介绍，<a href="http://www.template-toolkit.org/">在这里</a>。
当然，如果需要使用Template Toolkit的话，需要通过CPAN来额外安装，这一部分我会再另外写blog做介绍，今天先到此。
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/text-processing/" class="u-url">Text Processing</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/text-processing/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-03-11T12:57:32-04:00" title="2017-03-11 12:57">2017-03-11 12:57</time></a></span>
                    <span class="commentline">        <a href="%7Blink%7D" onclick="this.href='/posts/text-processing/'; this.target='_self';"><span class="IDCommentsReplace" style="display:none">cache/posts/text-processing.html</span>
<script>
var idcomments_acct = 'stephen_0921';
var idcomments_post_id = "cache/posts/text-processing.html";
var idcomments_post_url = "/posts/text-processing/";
</script><script src="http://www.intensedebate.com/js/genericLinkWrapperV2.js"></script></a>

</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">文本处理思路梳理</h2>
<div class="outline-text-2" id="text-1">
<p>
在日常的工作中，经常会遇到处理log或者文本的一些工作。但一时又想不到如果解决，提笔忘脚本。由此，我总结一些小的方法，给自己梳理一下思路，同时帮助别人。
</p>

<p>
按照文本处理的复杂程度，我们来决定用什么方法处理：
</p>
<ul class="org-ul">
<li>如果文本本身size不大，只是关键字的替换或者列操作等，那么就用编辑器处理了，比如vim或者Emacs。
</li>
<li>不想用编辑器打开文本，并且需要集成到其他脚本或者Makefile中，操作多是单行的，便于以后重复使用，推荐sed或者awk。
</li>
<li>需要处理比较复杂，或者要生成一些代码，推荐使用Perl。
</li>
</ul>
<p>
先说第一种情况，比如下面的代码。想要在下面的前四行代码，每行后面增加一些注释，比如"they are inputs"。
</p>
<div class="highlight"><pre><span></span>input a;
input b;
input c;
input d;
output e;
</pre></div>

<p>
先以vim为例，按ESC进入命令模式，在第一行按下“ma”，第四行按下“mb”，标记了我们想要操作的区域。然后按“:”，输入命令“'a,'bs/;$/; \/\/ they are inputs”；
“'a”和“'b”就是我们刚才标记的起点和终点，格式“s/xx/yy/”表示将“xx”替换成“yy”。注意这里，如果“yy”中包含“/”，需要使用反斜线进行转义。
</p>

<img src="images/text_processing1_vim.gif" class="img-thumbnail" width="60%"><p>
如果是Emacs，在第一行，组合键C-S-SPACE<sup><a id="fnr.1" name="fnr.1" class="footref" href="posts/text-processing/#fn.1">1</a></sup>标记区域的开始，光标来到在第五行的开头，可以看到我们选中了前四行，然后M-%，进行替换，最后的!表示全部替换。
</p>

<img src="images/text_processing1_emacs.gif" class="img-thumbnail" width="60%"><p>
再说第二种情况，文本比较大，不想打开，想把里面包含“delete me please!”的行都删掉。可以使用sed。
</p>
<div class="highlight"><pre><span></span>sed -e <span class="s1">'/delete me please!/d'</span> text.txt -i
</pre></div>
<p>
-e表示执行的命令，其中“/xx/d”表示去匹配xx然后删除，-i表示处理结果写会到原文件。
</p>

<p>
最后是第三种情况，比如有一个文本文件如下：
</p>
<div class="highlight"><pre><span></span>module a;
   input i_a;
   input i_a_not_this;

   output o_a;
endmodule // a

module b;
   input i_b;
   input i_b_not_this;

   output o_b;
endmodule // b
</pre></div>
<p>
我们想要把module b里的第一个input信号的名字换成module a里的第一个input信号的名字，这样比较适合Perl来做。
</p>
<div class="highlight"><pre><span></span><span class="k">my</span> <span class="nv">$in_a_module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$in_b_module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$input_a</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">while</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$line</span> <span class="o">=</span> <span class="o">&lt;&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$in_b_module</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="nb">defined</span> <span class="p">(</span><span class="nv">$input_a</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$end</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
	    <span class="nv">$line</span> <span class="o">=~</span><span class="sr">s/input(\s+)\w+/input$1$input_a/</span><span class="p">;</span>
	    <span class="nv">$line</span> <span class="o">.=</span> <span class="s">" // The line above is changed.\n"</span><span class="p">;</span>
	    <span class="nv">$end</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr">/endmodule/</span><span class="p">)</span> <span class="p">{</span>
	    <span class="nv">$in_b_module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="nv">$in_a_module</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr">/input\s+(\w+)/</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nb">defined</span> <span class="nv">$input_a</span><span class="p">)</span> <span class="p">{</span>
		    <span class="nv">$input_a</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="p">}</span>
	    <span class="p">}</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr">/endmodule/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$in_a_module</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr">/module a/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$in_a_module</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	    <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr">/module b/</span><span class="p">)</span> <span class="p">{</span>
		<span class="nv">$in_b_module</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="p">}</span>
    <span class="p">}</span>
    <span class="k">print</span> <span class="nv">$line</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>
运行的结果是：
</p>
<div class="highlight"><pre><span></span>module a;
   input i_a;
   input i_a_not_this;

   output o_a;
endmodule // a

module b;
   input i_a;
   input i_b_not_this;

   output o_b;
endmodule // b
</pre></div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef">
<sup><a id="fn.1" name="fn.1" class="footnum" href="posts/text-processing/#fnr.1">1</a></sup><p class="footpara">
C表示ctrl键，S表示shift键，SPACE表示空格键，中间的-表示同时按。
</p>
</div>


</div>
</div>
        </div>
        </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-2.html" rel="prev">Newer posts</a>
            </li>
        </ul></nav>
</div>
            </div>
        </div>
        <button class="btn btn-fab btn-raised btn-material-green btn-footer" data-toggle="modal" data-target="#footer-dialog">
            <i class="mdi-communication-message"></i>
        </button>
        <div id="footer-dialog" class="modal fade" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Yao He's Awesome Site credits</h4>
              </div>
              <div class="modal-body">
                    Contents © 2017         <a href="mailto:stephen0921@gmail.com">Yao He</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">Ok</button>
              </div>
            </div>
          </div>
        </div>
        <div class="source-button">
        </div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>

            $(document).ready(function() {
                // This command is used to initialize some elements and make them work properly
                $.material.init();
            });

            $(window).on("resize", function() {
                if($(window).width() > 767) {
                  $("html, body").height($(window).height());
                  $(".main, .menu").height($(window).height() - $(".header-panel").outerHeight() - 76 );
                  $(".posts-material").height($(window).height());
                } else {
                  $("html, body").css('height', '');
                  $(".main, .menu").css('height', '');
                  $(".posts-material").css('height', '');
                }
            }).trigger("resize");

            function menuToggle() {
                $("nav.menu, ul").toggleClass('responsive', '');
            }
        </script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><div id="container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script><script>
var gitment = new Gitment({
  owner: 'stephen0921',
  repo: 'github.com/stephen0921/blogcomments.git',
  oauth: {
    client_id: '023e6b0f82c8769a884b',
    client_secret: '7627cf219ccd3c1eabf6071ca10ff03da3a6df93',
  },
})
gitment.render('container')
</script>
</body>
</html>
