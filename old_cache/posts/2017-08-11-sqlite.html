
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Learn some SQL</h2>
<div class="outline-text-2" id="text-1">
<p>
  SQL(structured query language)可以理解为一种标准语言，不管底层最终的database是MySQL还是sqlite，都是支持这个标准语言的。虽然在脚本语言中，有DBI(database interface) module，比如Perl里的DBIx::Class，为用户操作数据库提供了便利的wrapper，但是了解一些基本的SQL操作，很有必要。
推荐两个非常棒的SQL教学视频，比如:<a href="https://www.youtube.com/watch?v=QjICgmk31js&list=PLGLfVvz_LVvTsslWD1HBQEjBbmAaAF9Xy&index=1">sqlite3 tutorial</a> 和 <a href="https://www.youtube.com/watch?v=yPu6qV5byu4&list=PLSBBbFozymr309Vzn5cmG2kxGKV6pHnKP&index=5">MySQL</a> 。
</p>

<p>
再回到我最近看的MojoExample源代码上来。Schema::Result::Blog.pm，有一段代码是这样:
</p>
<div class="highlight"><pre><span></span><span class="nn">__PACKAGE__</span><span class="o">-&gt;</span><span class="n">has_many</span><span class="p">(</span>
  <span class="s">&quot;blog_tags&quot;</span><span class="p">,</span>
  <span class="s">&quot;Schema::Result::BlogTag&quot;</span><span class="p">,</span>
  <span class="p">{</span> <span class="s">&quot;foreign.blog&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;self.id&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">cascade_copy</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cascade_delete</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">);</span>
</pre></div>
<p>
就是说一个Blog有多个BlogTag，table blog_tags的column成员blog映射到table blogs的column成员id上。
再来看Schema::Result::BlogTag.pm的一段:
</p>
<div class="highlight"><pre><span></span><span class="nn">__PACKAGE__</span><span class="o">-&gt;</span><span class="n">belongs_to</span><span class="p">(</span>
  <span class="s">&quot;blog&quot;</span><span class="p">,</span>
  <span class="s">&quot;Schema::Result::Blog&quot;</span><span class="p">,</span>
  <span class="p">{</span> <span class="n">id</span> <span class="o">=&gt;</span> <span class="s">&quot;blog&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">is_deferrable</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">on_delete</span> <span class="o">=&gt;</span> <span class="s">&quot;CASCADE&quot;</span><span class="p">,</span> <span class="n">on_update</span> <span class="o">=&gt;</span> <span class="s">&quot;CASCADE&quot;</span> <span class="p">},</span>
<span class="p">);</span>
</pre></div>
<p>
这个代码不够友好，参考这个帖子<a href="http://blog.johngoulah.com/2009/05/versioning-with-dbic/">versioning-with-dbic</a> 后，我们把这一段改一下:
</p>
<div class="highlight"><pre><span></span><span class="nn">__PACKAGE__</span><span class="o">-&gt;</span><span class="n">belongs_to</span><span class="p">(</span>
  <span class="s">&quot;blog&quot;</span><span class="p">,</span>
  <span class="s">&quot;Schema::Result::Blog&quot;</span><span class="p">,</span>
  <span class="p">{</span> <span class="s">&quot;foreign.id&quot;</span> <span class="o">=&gt;</span> <span class="s">&quot;self.blog&quot;</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">is_deferrable</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">on_delete</span> <span class="o">=&gt;</span> <span class="s">&quot;CASCADE&quot;</span><span class="p">,</span> <span class="n">on_update</span> <span class="o">=&gt;</span> <span class="s">&quot;CASCADE&quot;</span> <span class="p">},</span>
<span class="p">);</span>
</pre></div>
<p>
这样就清晰多了，table blogs的column成员id映射到table blog_tags的column成员blog上。
</p>

<p>
进到MojoExample目录下，看一下现有的数据库长什么样:
</p>
<div class="highlight"><pre><span></span>sqlite3 test.db
</pre></div>

<p>
发几个命令熟悉一下，最后一条是JOIN命令，另外还有LEFT JOIN，RIGHT JOIN等，去w3school上看吧。
</p>
<img src="../../images/sqlite3.png" class="img-thumbnail" width="60%" >
</div>
</div>
