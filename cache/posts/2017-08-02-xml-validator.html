
<div id="outline-container-orgc4a7156" class="outline-2">
<h2 id="orgc4a7156">XML Validator</h2>
<div class="outline-text-2" id="text-orgc4a7156">
<p>
当我在做uvm环境的generator脚本的时候，是通过XML来传递用户的定制参数的。比如cfg.xml的内容如下:
</p>
<div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE top
SYSTEM &quot;top.dtd.xml&quot;
&gt;
  &lt;top&gt;
    &lt;timescale value=&quot;1ns/1ps&quot; /&gt;
    &lt;dut name=&quot;mydut&quot; top_file=&quot;~/mydut.v&quot; filelist=&quot;~/mydut.f&quot; /&gt;
    &lt;tbp name=&quot;demo&quot; /&gt;
    &lt;env name=&quot;bus&quot; &gt;
      &lt;agent name=&quot;abc&quot; active=&quot;1&quot; off=&quot;0&quot; &gt;
	&lt;interface name=&quot;aa&quot; &gt;
	  &lt;ifclk name=&quot;clk&quot; /&gt;
	  &lt;ifrst name=&quot;rst&quot; /&gt;
	  &lt;signal name=&quot;ahb_burst&quot; bind=&quot;ahb_burst_o&quot; /&gt;
	  &lt;signal name=&quot;ahb_valid&quot; bind=&quot;ahb_valid_o&quot; /&gt;
	&lt;/interface&gt;
      &lt;/agent&gt;
    &lt;/env&gt;
  &lt;/top&gt;
</pre></div>

<p>
那么如何在第一时间去check用户输入的xml信息是否是正确的？这时候就用到了DTD文件作为一种validation的标准。假设top.dtd.xml的内容如下:
</p>
<div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
  &lt;!-- The top tag is the root tag. --&gt;
&lt;!ELEMENT top (timescale?,dut,tbp?,env) &gt;

&lt;!ELEMENT timescale EMPTY &gt;
  &lt;!ATTLIST timescale value CDATA #REQUIRED&gt;

&lt;!ELEMENT dut EMPTY&gt;
  &lt;!ATTLIST dut name CDATA #REQUIRED&gt;
  &lt;!ATTLIST dut top_file CDATA #REQUIRED&gt;
  &lt;!ATTLIST dut filelist CDATA #REQUIRED&gt;


&lt;!ELEMENT tbp EMPTY&gt;
  &lt;!ATTLIST tbp name CDATA #REQUIRED&gt;

&lt;!ELEMENT env (agent+)&gt;
  &lt;!ATTLIST env name CDATA #REQUIRED&gt;

&lt;!ELEMENT agent (interface)&gt;
  &lt;!ATTLIST agent name CDATA #REQUIRED&gt;
  &lt;!ATTLIST agent active CDATA #REQUIRED&gt;
  &lt;!ATTLIST agent off CDATA #REQUIRED&gt;

&lt;!ELEMENT interface (ifclk*,ifrst*,signal+)&gt;
  &lt;!ATTLIST interface name CDATA #REQUIRED&gt;

&lt;!ELEMENT ifclk EMPTY&gt;
  &lt;!ATTLIST ifclk name CDATA #REQUIRED&gt;

&lt;!ELEMENT ifrst EMPTY&gt;
  &lt;!ATTLIST ifrst name CDATA #REQUIRED&gt;

&lt;!ELEMENT signal EMPTY&gt;
  &lt;!ATTLIST signal name CDATA #REQUIRED&gt;
  &lt;!ATTLIST signal bind CDATA #IMPLIED&gt;
</pre></div>

<p>
我们用perl来处理XML文件的validation过程，如下:
</p>
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">XML::LibXML</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$parser</span> <span class="o">=</span> <span class="nn">XML::LibXML</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">;</span>

<span class="nv">$parser</span><span class="o">-&gt;</span><span class="n">validation</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$parser</span><span class="o">-&gt;</span><span class="n">parse_file</span><span class="p">(</span><span class="s">&quot;cfg.xml&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
