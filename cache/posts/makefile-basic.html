
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Makefile</h2>
<div class="outline-text-2" id="text-1">
<p>
使用Makefile管理软件流程，轻松便利，但有一些基本的语法，总是忘记，写此博文，给将来的好忘的我。
直接上干货：
</p>
<div class="highlight"><pre><span></span><span class="cp">ifndef TEST_MK</span>
  <span class="k">$(</span>error enviornment variable TEST_MK should be set!<span class="k">)</span>
<span class="cp">endif</span>

<span class="nv">HHH</span><span class="o">?=</span><span class="m">1</span>

<span class="cp">ifeq (&quot;$(HHH)&quot;,&quot;1&quot;)</span>
  <span class="nv">INFO</span><span class="o">=</span><span class="s2">&quot;HHH is 1 by default&quot;</span>
<span class="cp">else</span>
  <span class="nv">INFO</span><span class="o">=</span><span class="s2">&quot;HHH is set to other value </span><span class="k">$(</span>HHH<span class="k">)</span><span class="s2">&quot;</span>
<span class="cp">endif</span>

<span class="nf">compile</span><span class="o">:</span> <span class="n">gen_test</span>
<span class="cp">ifeq (&quot;$HHH&quot;,&quot;1&quot;)</span>
	<span class="nv">INFO</span><span class="o">=</span><span class="k">$(</span>INFO<span class="k">)</span> perl test.pl
<span class="cp">else</span>
	<span class="nv">INFO</span><span class="o">=</span><span class="k">$(</span>INFO<span class="k">)</span> perl test.pl
<span class="cp">endif</span>

<span class="nf">gen_test</span><span class="o">:</span> <span class="n">clean</span>
	@echo <span class="s2">&quot;my \$</span><span class="nv">$info</span><span class="s2"> = \$</span><span class="nv">$ENV</span><span class="s2">{&#39;INFO&#39;};print \&quot;We get in perl: \$</span><span class="nv">$info</span><span class="s2">\\n\&quot;;print \&quot;We can get TEST_MK!\\n\&quot; if (defined \$</span><span class="nv">$ENV</span><span class="s2">{&#39;TEST_MK&#39;});&quot;</span> &gt; test.pl

<span class="nf">clean</span><span class="o">:</span>
	rm -rf test.pl
</pre></div>

<p>
命令行输入：
</p>
<div class="highlight"><pre><span></span>setenv TEST_MK hello<span class="p">;</span>make
</pre></div>

<p>
结果是：
</p>
<div class="highlight"><pre><span></span>rm -rf test.pl
<span class="nv">INFO</span><span class="o">=</span><span class="s2">&quot;HHH is 1 by default&quot;</span> perl test.pl
We get in perl: HHH is <span class="m">1</span> by default
We can get TEST_MK!
</pre></div>

<p>
关键的点有下面几个：
</p>
<ul class="org-ul">
<li>对环境变量的判断，使用ifndef，同时用error来输出错误信息，并停止。
</li>
<li>使用“?=”来设置default值，如果想在命令行对变量“HHH”赋值：
</li>
</ul>
<div class="highlight"><pre><span></span>make <span class="nv">HHH</span><span class="o">=</span><span class="m">2</span>
</pre></div>
<ul class="org-ul">
<li>判断变量值用ifeq
</li>
<li>最重要的一点，Makefile和Perl天生八字不合，好好的“$”，在Makefile里要写成"\$$"，我也是醉了。
</li>
<li>一般的情况下，执行的命令都会显示出来，除非在前面加上“@”。
</li>
<li>“INFO=$(INFO) perl test.pl”表示的是，把环境变量INFO传到perl的命令里去。
</li>
</ul>
</div>
</div>
