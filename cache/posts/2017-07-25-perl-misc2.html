
<div id="outline-container-org65f1ca0" class="outline-2">
<h2 id="org65f1ca0">perl OOP 浅尝辄止一</h2>
<div class="outline-text-2" id="text-org65f1ca0">
<p>
在perl中，至少是perl5中，class是通过package来实现的，如下。
</p>
<div class="highlight"><pre><span></span><span class="k">package</span> <span class="nn">CD</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">sub</span> <span class="nf">new</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$class</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nb">bless</span> <span class="nv">$self</span><span class="p">,</span> <span class="nv">$class</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">sub</span> <span class="nf">init</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="nv">$self</span><span class="o">-&gt;</span><span class="p">{</span><span class="n">music</span><span class="p">}</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">print_me</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;music = $self-&gt;{music}\n&quot;</span><span class="p">;</span>
<span class="p">}</span> 
<span class="mi">1</span><span class="p">;</span>
</pre></div>

<p>
有几个注意的点:
</p>
<ul class="org-ul">
<li>bless是把hash ref和class关联起来，每一个objet其实就是一个hash ref;</li>
<li>注意$class和$self不要混淆了，$class就是new的时候传进来的类名字，$self是hash ref;</li>
<li>package 最后的返回1，必不可少;</li>
</ul>

<p>
我们来使用这个类，如下:
</p>
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">FindBin</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">lib</span> <span class="s">&quot;$FindBin::Bin&quot;</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">CD</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$cd</span> <span class="o">=</span> <span class="nn">CD</span><span class="o">-&gt;</span><span class="k">new</span><span class="p">;</span>

<span class="nv">$cd</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="s">&#39;ABC&#39;</span><span class="p">);</span>

<span class="nv">$cd</span><span class="o">-&gt;</span><span class="n">print_me</span><span class="p">;</span>
</pre></div>

<ul class="org-ul">
<li>为了让perl解释器能够找到我们的类，通过FindBin来指出路径;</li>
<li>构建一个类的对象时，千万不能写成CD::new，要定位好久才发现，CD::new其实是选择了namespace的CD这个package里的new，并不是执行一个class的new函数;</li>
</ul>
</div>
</div>
