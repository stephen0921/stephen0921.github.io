<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Some tips and notes need to write here.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yao He's Awesome Site</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://stephen0921.github.io/">
<link rel="next" href="index-3.html" type="text/html">
<!--[if lt IE 9]>
            <script src="assets/js/html5shiv.min.js"></script>
            <script src="assets/js/respond.min.js"></script>
        <![endif]--><link rel="prefetch" href="posts/2017-12-06-tmux-part1/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar  header-panel shadow-z-3" role="navigation"><div class="container-fluid">
        <div class="row">
          <div class="col-xs-3">
            <h1 class="title-blog">
                <a href="https://stephen0921.github.io/">
                        <span id="blog-title">Yao He's Awesome Site</span>
                    </a>
            </h1>
          </div>
          <div class="col-xs-9">
            <a id="hamburger" class="btn btn-raised" href="javascript:void(0);" onclick="menuToggle();">☰</a>
          </div>
        </div>
      </div>
<!-- /.container-fluid -->
</nav><div class="container-fluid main" id="content" role="main">
        <div class="row">
            <nav class="col-xs-12 col-sm-3 menu"><ul>
<li class="withripple"><a href="archive.html">Archive</a></li>
                <li class="withripple"><a href="categories/">Tags</a></li>
                <li class="withripple"><a href="rss.xml">RSS feed</a></li>

                    
                </ul>
<ul></ul></nav><div class="posts-material col-xs-12 col-sm-9">
                <div class="col-xs-12 col-md-11 content-material">

    <div class="postindex well post-material ">
    
        <article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-12-06-tmux-part1/" class="u-url">Tmux introduction</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-12-06-tmux-part1/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-12-06T22:35:32+08:00" title="2017-12-06 22:35">2017-12-06 22:35</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
什么是Tmux?
</p>

<p>
Tmux可以理解为是一个terminal控制器,是对我们的terminal的扩展,同时我们可以利用它来建立自己的一套workflow.
先上一张图,感受一下.
</p>

<img src="images/tmux.png" class="img-thumbnail" width="80%"><p>
Terminal的上半部分是打开了vim准备编辑,下半部分竖直拆分成2个部分.
</p>

<p>
为什么要用Tmux?
</p>

<p>
原因一,在一个Terminal上实现了多窗口控制,便于写代码同时调试;
</p>

<p>
原因二,Tmux为我们在后台保存了一个进程,记录了我们当前的窗口状态,即使关闭这个Terminal,只要下次再打开Tmux,立刻恢复退出前的状态.
</p>

<p>
原因三,我们可以给Tmux提供一组配置文件,这样可以在每次建立窗口前,预先设置好环境,提高了工作效率.
</p>

<p>
怎么用Tmux?
</p>

<p>
首先,先建立一个Tmux进程,这里有专门的术语–session.
</p>

<div class="highlight"><pre><span></span>tmux new-session -t abc
</pre></div>

<p>
我们通过上面的命令得到了一个Tmux session,名字叫abc.
</p>

<img src="images/newsession.png" class="img-thumbnail" width="80%"><p>
这个时候Terminal底部的绿色状态栏提示我们,目前是在一个Tmux的session中.现在我们就可以做一些分割窗口的操作了.Tmux的所有命令都有同样的一个前缀,就是"ctrl+b"<sup><a id="fnr.1" name="fnr.1" class="footref" href="posts/2017-12-06-tmux-part1/#fn.1">1</a></sup>.我们按"ctrl+b",然后按"%",Terminal就被竖直分成了两个部分.这每一部分称为pane.在pane之间来回移动光标的命令是"前缀-o"<sup><a id="fnr.2" name="fnr.2" class="footref" href="posts/2017-12-06-tmux-part1/#fn.2">2</a></sup>.
</p>

<img src="images/split.png" class="img-thumbnail" width="80%"><p>
我们先断开session连接,命令是"前缀-d".
</p>

<p>
然后在terminal中输入命令，来查看后台有哪些Tmux的session.
</p>

<div class="highlight"><pre><span></span>tmux ls
</pre></div>

<p>
结果显示如下,有一个Tmux后台进程,session名为abc.
</p>
<img src="images/tmuxls.png" class="img-thumbnail" width="80%"><p>
我们再通过下面的命令,重新连接到session abc去.
</p>

<div class="highlight"><pre><span></span>tmux attach -t abc
</pre></div>

<p>
未完待续.
</p>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef">
<sup><a id="fn.1" name="fn.1" class="footnum" href="posts/2017-12-06-tmux-part1/#fnr.1">1</a></sup><p class="footpara">
"+"表示两个键同时按.
</p>
</div>

<div class="footdef">
<sup><a id="fn.2" name="fn.2" class="footnum" href="posts/2017-12-06-tmux-part1/#fnr.2">2</a></sup><p class="footpara">
"-"表示按键依次按.
</p>
</div>


</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-10-31-emacs-rectangle/" class="u-url">Emacs column edit</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-10-31-emacs-rectangle/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-10-31T18:35:32+08:00" title="2017-10-31 18:35">2017-10-31 18:35</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
以前一直觉得emacs的列操作不如vim好用，经过最近一段时间的深入使用，让我的看法有所改变。比如下面的代码我想多加4组agent，那么怎么做呢？
</p>
<div class="highlight"><pre><span></span>agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));
</pre></div>
<p>
先copy四行出来。
</p>
<div class="highlight"><pre><span></span>agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));

// the 4 lines below are copied from above
agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));
</pre></div>
<p>
然后，先选中要修改的4行，然后M-C-%(或者M-x，键入query-replace-regexp, 回车)，在mini-buffer中输入被替换的表达式是
</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+
</pre></div>
<p>
目标表达式是 
</p>
<div class="highlight"><pre><span></span><span class="se">\,</span> <span class="o">(</span>+ <span class="m">4</span> <span class="se">\#</span><span class="p">&amp;</span><span class="o">)</span>
</pre></div>
<p>
然后回车，就有一个交互式提示，想要替换掉的，按y，不想替换的按n，如果想全部替换的话，按！,具体命令可以按？来查询。
如图所示。
</p>

<img src="images/emacs.PNG" class="img-thumbnail" width="60%"><p>
经过4轮的"yynn"后就得到了下面的代码。
</p>
<div class="highlight"><pre><span></span>agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));

// the 4 lines below are copied from above, then replace
agent4 u_agent_4(.clk1(clk),.rst1(rst));
agent5 u_agent_5(.clk1(clk),.rst1(rst));
agent6 u_agent_6(.clk1(clk),.rst1(rst));
agent7 u_agent_7(.clk1(clk),.rst1(rst));
</pre></div>
<p>
这个过程略显复杂，如果是emacs版本25.2的话，就可以使用(rectangle-mark-mode)来单独选中要改变的列，然后整体替换就ok了。
如下图所示。
</p>
<img src="images/emacs-rect.PNG" class="img-thumbnail" width="60%"><img src="images/emacs-rect-2.PNG" class="img-thumbnail" width="60%">
</div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-09-22-openxmlformat/" class="u-url">Use Openxmlformat to Generate WORD DOC</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-09-22-openxmlformat/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-09-22T11:55:32+08:00" title="2017-09-22 11:55">2017-09-22 11:55</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Generating MS-WORD doc using openxmlformat</h2>
<div class="outline-text-2" id="text-1">
<p>
使用openxmlformat格式来描述，可以用WORD打开的xml文档。
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-09-12-emacs-tags-verdi/" class="u-url">Generate Tags for Emacs by Verdi</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-09-12-emacs-tags-verdi/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-09-12T10:35:32+08:00" title="2017-09-12 10:35">2017-09-12 10:35</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Generate Tags for Emacs by Verdi</h2>
<div class="outline-text-2" id="text-1">
<p>
无意中看到SNUG的一个文章，作者通过使用Verdi来生成Emacs以及Vim的tags文件，很棒。我一直没有找到特别好的办法来用Emacs浏览verilog 代码工程，之前也是使用Emacs的插件projectile来grep关键字。我赶紧按照作者的描述操作起来了。
</p>

<img src="images/tags.png" class="img-thumbnail" width="60%"><p>
作者的tcl脚本是放在<a href="https://www.vc-apps.org/sitepages/downloadList.aspx">这里的</a> ，居然排在第一个。
</p>

<img src="images/vcc.PNG" class="img-thumbnail" width="60%"><p>
在Verdi打开tcl命令窗口，然后source下载的tcl脚本。
</p>

<img src="images/verdi.PNG" class="img-thumbnail" width="60%"><p>
生成的vim版本的tags文件是ok的，能用。Emacs版本的TAGS文件居然不能跳转！
</p>

<p>
仔细查了一遍，应该是作者把emacs tags文件的格式弄错了，看来作者一定是vim用户了，或者我使用的emacs版本（25.2）太高了？
</p>

<p>
再看了一遍论文，作者文字描述的格式和他实际脚本生成的TAGS格式不一致，把tag_definition_text丢掉了，所以跳转有问题。
</p>

<img src="images/emacs_tags_format.png" class="img-thumbnail" width="60%"><p>
去<a href="https://www.vc-apps.org/sitepages/gettingstarted.aspx">官网</a>查到了npi参考手册，fix一下tcl代码。
</p>

<div class="highlight"><pre><span></span><span class="k">foreach</span> <span class="k">{</span><span class="nv">index</span> tagInfo<span class="k">}</span> <span class="nv">$sorted_ident</span> <span class="k">{</span>
  <span class="k">set</span> srcFile <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$tagInfo</span><span class="k">]</span> <span class="mi">1</span><span class="k">]</span>
  <span class="k">if</span> <span class="k">{</span><span class="nv">$fileName</span> <span class="o">==</span> <span class="nv">$srcFile</span><span class="k">}</span> <span class="k">{</span>
    <span class="k">set</span> tag <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$tagInfo</span><span class="k">]</span> <span class="mi">0</span><span class="k">]</span>
    <span class="k">set</span> line <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$tagInfo</span><span class="k">]</span> <span class="mi">2</span><span class="k">]</span>
    <span class="k">set</span> offset <span class="nv">$byteCounts</span><span class="k">(</span><span class="nv">$line</span><span class="k">)</span>

    <span class="c">#======= fix by yaohe begin ===========#</span>
      <span class="c">#set entry "\x7f$tag\x01,$offset"</span>
      <span class="k">set</span> file_hdl <span class="k">[</span><span class="nv">npi_text_file_by_name</span> <span class="o">-</span>name <span class="s2">"$srcFile"</span><span class="k">]</span>
      <span class="k">set</span> line_hdl <span class="k">[</span><span class="nv">npi_text_line_by_number</span> <span class="o">-</span>ref <span class="nv">$file_hdl</span> <span class="o">-</span>number <span class="nv">$line</span><span class="k">]</span>
      <span class="k">set</span> line_content <span class="k">[</span><span class="nv">npi_text_property_str</span> <span class="o">-</span>type npiTextLineContent <span class="o">-</span>ref <span class="nv">$line_hdl</span><span class="k">]</span>
      <span class="nb">regsub</span> <span class="k">{</span><span class="err">\</span><span class="nv">n</span><span class="err">$</span><span class="k">}</span> <span class="nv">$line_content</span> <span class="k">{}</span> line_content
      <span class="k">set</span> entry <span class="s2">"$line_content\x7f$line,$offset"</span>
    <span class="c">#======= fix by yaohe end ===========#</span>

    <span class="nb">append</span> entryList <span class="s2">"\n"</span> <span class="nv">$entry</span>
  <span class="k">}</span>
<span class="k">}</span>
</pre></div>

<p>
终于好用了。
</p>

<img src="images/emacs_tags_ok.png" class="img-thumbnail" width="60%"><p>
新的tcl代码我备份我的<a href="https://github.com/stephen0921/GenEmacsTagsByVerdi">github</a>上，因为实在联系不上作者。
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-09-11-uvm-ref-flow1/" class="u-url">UVM Example Reference 1</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-09-11-uvm-ref-flow1/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-09-11T15:05:32+08:00" title="2017-09-11 15:05">2017-09-11 15:05</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">UVM Example Reference 1</h2>
<div class="outline-text-2" id="text-1">
<p>
uvm_ref_flow_1.2是不错的学习材料，从UT到SOC的环境都可以参考这里面的代码来写，至少可以当做代码的模板来用。
</p>

<p>
和我之前一般看到的做法不同，monitor被完全实现在了transaction level，signal level的东西放在了一个叫collector的class里面。
</p>

<p>
还有一个特别值得说明是，在apb_slave_seq_lib.sv中的simple_response_seq通过其p_sequencer的tlm接口addr_trans_port来生成包，不错的应用方法。
</p>

<div class="highlight"><pre><span></span>class simple_response_seq extends uvm_sequence #(apb_transfer);
   // ...
   virtual task body();
      `uvm_info(get_type_name(), "Starting...", UVM_MEDIUM)
      forever begin
	 p_sequencer.addr_trans_port.peek(util_transfer);
	 // ...
      end
   endtask : body
endclass : simple_response_seq
</pre></div>

<p>
为了让sequencer能看到发包的情况，建立了一条tlm通道。从总线到apb_collector，再到apb_monitor，最后到apb_slave_sequencer。
</p>
<img src="images/uvm_ref_flow1.png" class="img-thumbnail" width="60%"><p>
用事件来在同一个class的两个task之间做同步和信息传递，用peek的tlm通路来层层传递。
</p>
<div class="highlight"><pre><span></span>class apb_slave_sequencer extends uvm_sequencer #(apb_transfer);
   // ...
   uvm_blocking_peek_port#(apb_transfer) addr_trans_port;
   // ...
endclass : apb_slave_sequencer

class apb_monitor extends uvm_monitor;
   // ...
   // Allows the sequencer to look at monitored data for responses
  uvm_blocking_peek_imp#(apb_transfer,apb_monitor) addr_trans_export;

  // Allows monitor to look at collector for address information
  uvm_blocking_peek_port#(apb_transfer) addr_trans_port;

  event trans_addr_grabbed;
endclass : apb_monitor

  // UVM run_phase
task apb_monitor::run_phase(uvm_phase phase);
  forever begin
    addr_trans_port.peek(trans_collected);
    `uvm_info(get_type_name(), $sformatf("Address Phase Complete: %h[%s]", trans_collected.addr, trans_collected.direction.name() ), UVM_HIGH)
    -&gt; trans_addr_grabbed;
  end
endtask : run_phase

// FUNCTION: peek - Allows the sequencer to peek at monitor for responses
task apb_monitor::peek(output apb_transfer trans);
  @trans_addr_grabbed;
  trans = trans_collected;
endtask : peek

class apb_collector extends uvm_component;
   // ...
   // TLM Port - Allows sequencer access to transfer during address phase
  uvm_blocking_peek_imp#(apb_transfer,apb_collector) addr_trans_export;
  event addr_trans_grabbed;
endclass : apb_collector

   // UVM run_phase()
task apb_collector::run_phase(uvm_phase phase);
    @(posedge vif.preset);
    `uvm_info(get_type_name(), "Detected Reset Done", UVM_LOW)
    collect_transactions();
endtask : run_phase

// collect_transactions
task apb_collector::collect_transactions();
  forever begin
    @(posedge vif.pclock iff (vif.psel != 0));
    void'(this.begin_tr(trans_collected,"APB_COLLECTOR","UVM Debug","APB collector transaction inside collect_transactions()"));
    trans_collected.addr = vif.paddr;
    trans_collected.master = cfg.master_config.name;
    trans_collected.slave = cfg.get_slave_name_by_addr(trans_collected.addr);
    case (vif.prwd)
      1'b0 : trans_collected.direction = APB_READ;
      1'b1 : trans_collected.direction = APB_WRITE;
    endcase
      @(posedge vif.pclock);
    if(trans_collected.direction == APB_READ)
      trans_collected.data = vif.prdata;
    if (trans_collected.direction == APB_WRITE)
      trans_collected.data = vif.pwdata;
    -&gt; addr_trans_grabbed;
    @(posedge vif.pclock);
    if(trans_collected.direction == APB_READ) begin
	if(vif.pready != 1'b1)
	  @(posedge vif.pclock);
      trans_collected.data = vif.prdata;
      end
    this.end_tr(trans_collected);
    item_collected_port.write(trans_collected);
    `uvm_info(get_type_name(), $sformatf("Transfer collected :\n%s",
	      trans_collected.sprint()), UVM_MEDIUM)
      `ifdef HEAP
      runq.push_back(trans_collected);
      `endif
     num_transactions++;
    end
endtask : collect_transactions

task apb_collector::peek(output apb_transfer trans);
  @addr_trans_grabbed;
  trans = trans_collected;
endtask : peek
</pre></div>

<p>
再看一下连接关系。
</p>
<div class="highlight"><pre><span></span>// UVM connect_phase
function void apb_env::connect_phase(uvm_phase phase);
  super.connect_phase(phase);
  // Get the virtual interface if set via get_config
  if (!uvm_config_db#(virtual apb_if)::get(this, "", "vif", vif))
    `uvm_error("NOVIF",{"virtual interface must be set for: ",get_full_name(),".vif"})
  bus_collector.item_collected_port.connect(bus_monitor.coll_mon_port);
  bus_monitor.addr_trans_port.connect(bus_collector.addr_trans_export);
  master.monitor = bus_monitor;
  master.collector = bus_collector;
  foreach(slaves[i]) begin
    slaves[i].monitor = bus_monitor;
    slaves[i].collector = bus_collector;
    if (slaves[i].is_active == UVM_ACTIVE)
      slaves[i].sequencer.addr_trans_port.connect(bus_monitor.addr_trans_export);
  end
endfunction : connect_phase
</pre></div>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-08-30-emacs-verilog/" class="u-url">Emacs verilog mode</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-08-30-emacs-verilog/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-08-30T17:25:32+08:00" title="2017-08-30 17:25">2017-08-30 17:25</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Emacs的verilog mode</h2>
<div class="outline-text-2" id="text-1">
<p>
是不是觉得verilog的语法，有一些啰嗦呢，实例的例化、信号连接工作太无聊呢？来来来，试试Emacs。
有人说Emacs老土的编辑器了，现在没有人用了吧，还真不是，其强大的扩展性（可折腾性），真是IC验证人的出门在外必备良药啊。
那么在哪里能安装呢？<a href="https://www.gnu.org/software/emacs/download.html">来这里找</a> 。
</p>

<p>
如果是windows版本，需要设置一下环境变量。方法是，控制面板-&gt;系统-&gt;高级系统设置-&gt;环境变量-&gt;新建-&gt;变量名是HOME-&gt;变量值是C:\Users\heyao\documents。
</p>

<p>
根据自己的需要选择合适的变量值，用来存放用户的.emacs.d文件夹以及.emacs文件，我选择的是C:\Users\heyao\documents。.emacs.d主要是用来放置一下emacs的插件，.emacs是用户自己的初始化设置。
</p>

<p>
先不折腾这个配置，打开emacs，敲入下面代码:
</p>
<div class="highlight"><pre><span></span>module fanout (/*AUTOARG*/)
   input i;
   output [31:0] o;
   wire [31:0] o = {32{i}};
endmodule
</pre></div>

<p>
保存，（快捷键CTRL+x CTRL+s，为了便于说明，用C-x C-s来表示），命名文件为fanout.v。
</p>

<p>
然后，用户C-c C-a，代码就变成了如下:
</p>
<div class="highlight"><pre><span></span>module fanout (/*AUTOARG*/
   // Outputs
   o,
   // Inputs
   i
   )
   input i;
   output [31:0] o;
   wire [31:0] o = {32{i}};
endmodule
</pre></div>

<p>
我们再C-x 3，并排打开窗口，然后C-x C-f，新建一个文件ex_inst.v，如下:
</p>
<div class="highlight"><pre><span></span>module ex_inst (/*AUTOARG*/)
   input i;
   output [31:0] o;
   inout      io;

   fanout fanout (/*AUTOINST*/);
endmodule
</pre></div>
<p>
然后，C-c C-a，代码就变成了如下:
</p>
<div class="highlight"><pre><span></span>module ex_inst (/*AUTOARG*/
   // Outputs
   o,
   // Inouts
   io,
   // Inputs
   i
   )
   input i;
   output [31:0] o;
   inout      io;

   fanout fanout (/*AUTOINST*/
	  // Outputs
	  .o            (o[31:0]),
	  // Inputs
	  .i            (i));
endmodule
</pre></div>

<p>
可以看到Emacs自动帮忙做了实例化。
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-08-15-ieee-floating/" class="u-url">IEEE Floating Point Number</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-08-15-ieee-floating/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-08-15T16:33:53+08:00" title="2017-08-15 16:33">2017-08-15 16:33</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">IEEE Standard 754</h2>
<div class="outline-text-2" id="text-1">
<p>
关于浮点数的标准，这个讲得很清晰，尤其是关于denormalized。
</p>

<p>
<a href="http://steve.hollasch.net/cgindex/coding/ieeefloat.html">ieeefloat</a>
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-08-11-sqlite/" class="u-url">Learn some SQL</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-08-11-sqlite/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-08-11T17:19:11+08:00" title="2017-08-11 17:19">2017-08-11 17:19</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Learn some SQL</h2>
<div class="outline-text-2" id="text-1">
<p>
  SQL(structured query language)可以理解为一种标准语言，不管底层最终的database是MySQL还是sqlite，都是支持这个标准语言的。虽然在脚本语言中，有DBI(database interface) module，比如Perl里的DBIx::Class，为用户操作数据库提供了便利的wrapper，但是了解一些基本的SQL操作，很有必要。
推荐两个非常棒的SQL教学视频，比如:<a href="https://www.youtube.com/watch?v=QjICgmk31js&amp;list=PLGLfVvz_LVvTsslWD1HBQEjBbmAaAF9Xy&amp;index=1">sqlite3 tutorial</a> 和 <a href="https://www.youtube.com/watch?v=yPu6qV5byu4&amp;list=PLSBBbFozymr309Vzn5cmG2kxGKV6pHnKP&amp;index=5">MySQL</a> 。
</p>

<p>
再回到我最近看的MojoExample源代码上来。Schema::Result::Blog.pm，有一段代码是这样:
</p>
<div class="highlight"><pre><span></span><span class="nn">__PACKAGE__</span><span class="o">-&gt;</span><span class="n">has_many</span><span class="p">(</span>
  <span class="s">"blog_tags"</span><span class="p">,</span>
  <span class="s">"Schema::Result::BlogTag"</span><span class="p">,</span>
  <span class="p">{</span> <span class="s">"foreign.blog"</span> <span class="o">=&gt;</span> <span class="s">"self.id"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">cascade_copy</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cascade_delete</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">},</span>
<span class="p">);</span>
</pre></div>
<p>
就是说一个Blog有多个BlogTag，table blog_tags的column成员blog映射到table blogs的column成员id上。
再来看Schema::Result::BlogTag.pm的一段:
</p>
<div class="highlight"><pre><span></span><span class="nn">__PACKAGE__</span><span class="o">-&gt;</span><span class="n">belongs_to</span><span class="p">(</span>
  <span class="s">"blog"</span><span class="p">,</span>
  <span class="s">"Schema::Result::Blog"</span><span class="p">,</span>
  <span class="p">{</span> <span class="n">id</span> <span class="o">=&gt;</span> <span class="s">"blog"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">is_deferrable</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">on_delete</span> <span class="o">=&gt;</span> <span class="s">"CASCADE"</span><span class="p">,</span> <span class="n">on_update</span> <span class="o">=&gt;</span> <span class="s">"CASCADE"</span> <span class="p">},</span>
<span class="p">);</span>
</pre></div>
<p>
这个代码不够友好，参考这个帖子<a href="http://blog.johngoulah.com/2009/05/versioning-with-dbic/">versioning-with-dbic</a> 后，我们把这一段改一下:
</p>
<div class="highlight"><pre><span></span><span class="nn">__PACKAGE__</span><span class="o">-&gt;</span><span class="n">belongs_to</span><span class="p">(</span>
  <span class="s">"blog"</span><span class="p">,</span>
  <span class="s">"Schema::Result::Blog"</span><span class="p">,</span>
  <span class="p">{</span> <span class="s">"foreign.id"</span> <span class="o">=&gt;</span> <span class="s">"self.blog"</span> <span class="p">},</span>
  <span class="p">{</span> <span class="n">is_deferrable</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">on_delete</span> <span class="o">=&gt;</span> <span class="s">"CASCADE"</span><span class="p">,</span> <span class="n">on_update</span> <span class="o">=&gt;</span> <span class="s">"CASCADE"</span> <span class="p">},</span>
<span class="p">);</span>
</pre></div>
<p>
这样就清晰多了，table blogs的column成员id映射到table blog_tags的column成员blog上。
</p>

<p>
进到MojoExample目录下，看一下现有的数据库长什么样:
</p>
<div class="highlight"><pre><span></span>sqlite3 test.db
</pre></div>

<p>
发几个命令熟悉一下，最后一条是JOIN命令，另外还有LEFT JOIN，RIGHT JOIN等，去w3school上看吧。
</p>
<img src="images/sqlite3.png" class="img-thumbnail" width="60%">
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-08-10-my-our/" class="u-url">My, Our and Local in Perl</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-08-10-my-our/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-08-10T13:44:21+08:00" title="2017-08-10 13:44">2017-08-10 13:44</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">My, Our and local</h2>
<div class="outline-text-2" id="text-1">
<p>
"my"比较常见，"our"和"local"偶尔会出现。查了好多文档，比如perldoc中的perlmod说明，也是比较模糊，而且又提到"lexical"变量的说法，更是让人一头雾水。下面这个文档比较清晰，值得一读。它从Perl发展的历史角度来讲述区别，同时解释了package变量和"lexical"变量的含义。
<a href="http://perl.plover.com/FAQs/Namespaces.html">Coping with Scoping</a>
</p>

<p>
举一个例子，加深理解。
</p>

<div class="highlight"><pre><span></span><span class="k">package</span> <span class="nn">abc</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="nv">$VERSION</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">get_ver</span> <span class="p">{</span><span class="nv">$VERSION</span><span class="p">}</span>

<span class="k">package</span> <span class="nn">main</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"step 1: $abc::VERSION\n"</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"step 2: "</span><span class="o">.</span> <span class="nn">abc::</span><span class="n">get_ver</span><span class="p">();</span>
</pre></div>

<p>
如上面代码所示，我们想在"package abc"中使用具有全局属性的package变量"$VERSION"，但是由于用了"use strict"，所以上面一段代码编译会报如下错。
</p>
<div class="highlight"><pre><span></span>Global symbol <span class="s2">"</span><span class="nv">$VERSION</span><span class="s2">"</span> requires explicit package name <span class="o">(</span>did you forget to <span class="nb">declare</span> <span class="s2">"my </span><span class="nv">$VERSION</span><span class="s2">"</span>?<span class="o">)</span> at a.pl line <span class="m">7</span>.
Global symbol <span class="s2">"</span><span class="nv">$VERSION</span><span class="s2">"</span> requires explicit package name <span class="o">(</span>did you forget to <span class="nb">declare</span> <span class="s2">"my </span><span class="nv">$VERSION</span><span class="s2">"</span>?<span class="o">)</span> at a.pl line <span class="m">10</span>.
Execution of a.pl aborted due to compilation errors.
</pre></div>

<p>
根据提示我们可以修改成下面这样，在package abc内部使用自己的变量也要加上package名称做前缀:
</p>
<div class="highlight"><pre><span></span><span class="k">package</span> <span class="nn">abc</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="nv">$</span><span class="nn">abc::</span><span class="nv">VERSION</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">get_ver</span> <span class="p">{</span><span class="nv">$</span><span class="nn">abc::</span><span class="nv">VERSION</span><span class="p">}</span>

<span class="k">package</span> <span class="nn">main</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"step 1: $abc::VERSION\n"</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"step 2: "</span><span class="o">.</span> <span class="nn">abc::</span><span class="n">get_ver</span><span class="p">();</span>
</pre></div>

<p>
为了不这样麻烦，出现了our函数，这样我们就能更优雅一点的使用package变量了:
</p>
<div class="highlight"><pre><span></span><span class="k">package</span> <span class="nn">abc</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span>

<span class="k">our</span> <span class="nv">$VERSION</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">get_ver</span> <span class="p">{</span><span class="nv">$VERSION</span><span class="p">}</span>

<span class="k">package</span> <span class="nn">main</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"step 1: $abc::VERSION\n"</span><span class="p">;</span>
<span class="k">print</span> <span class="s">"step 2: "</span><span class="o">.</span> <span class="nn">abc::</span><span class="n">get_ver</span><span class="p">();</span>
</pre></div>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-08-07-uvm-reporter/" class="u-url">Uvm Reporter Mechanism</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-08-07-uvm-reporter/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-08-07T15:34:50+08:00" title="2017-08-07 15:34">2017-08-07 15:34</time></a></span>
                    <span class="commentline">        
</span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">UVM Reporter Mechanism</h2>
<div class="outline-text-2" id="text-1">
<p>
UVM的log打印分为6个等级，如下图所示:
</p>
<img src="images/uvm_verbosity.png" class="img-thumbnail" width="60%"><p>
由下至上，打印的等级逐级升高。假设在一个task里面有如下的代码，那么即将打印的是后三条。
</p>
<div class="highlight"><pre><span></span>`uvm_info("ID0", "this is debug message", UVM_DEBUG)
`uvm_info("ID1", "this is full message", UVM_FULL)
`uvm_info("ID2", "this is high message", UVM_HIGH)
`uvm_info("ID3", "this is medium message", UVM_MEDIUM)
`uvm_info("ID4", "this is low message", UVM_LOW)
`uvm_info("ID5", "this is none message", UVM_NONE)
</pre></div>

<img src="images/uvm_log.png" class="img-thumbnail" width="60%"><p>
因为仿真器默认的verbosity是UVM_MEDIUM，所以ID0~ID2的信息没有打印出来。可以通过命令行来修改打印的verbosity，比如:
</p>
<div class="highlight"><pre><span></span>+uvm_set_verbosity<span class="o">=</span>component_name,id,verbosity,phase_name,optional_time
</pre></div>

<p>
`uvm_warning、`uvm_error、`uvm_fatal可以看作是verbosity都是UVM_NONE的`uvm_info，所以它们是默认打印的。但是它们的行为可以通过命令行改变，比如默认的`uvm_fatal是要立刻停止仿真的，但是可以通过+uvm_set_action来改变它。
</p>
<div class="highlight"><pre><span></span>+uvm_set_action<span class="o">=</span>component,id,severity,action
</pre></div>

<p>
这里可以做简单的练习:
<a href="http://www.edaplayground.com/x/5xF7">my simple test</a>
</p>
</div>
</div>
        </div>
        </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-3.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
            </div>
        </div>
        <button class="btn btn-fab btn-raised btn-material-green btn-footer" data-toggle="modal" data-target="#footer-dialog">
            <i class="mdi-communication-message"></i>
        </button>
        <div id="footer-dialog" class="modal fade" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Yao He's Awesome Site credits</h4>
              </div>
              <div class="modal-body">
                    Contents © 2017         <a href="mailto:stephen0921@gmail.com">Yao He</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">Ok</button>
              </div>
            </div>
          </div>
        </div>
        <div class="source-button">
        </div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>

            $(document).ready(function() {
                // This command is used to initialize some elements and make them work properly
                $.material.init();
            });

            $(window).on("resize", function() {
                if($(window).width() > 767) {
                  $("html, body").height($(window).height());
                  $(".main, .menu").height($(window).height() - $(".header-panel").outerHeight() - 76 );
                  $(".posts-material").height($(window).height());
                } else {
                  $("html, body").css('height', '');
                  $(".main, .menu").css('height', '');
                  $(".posts-material").css('height', '');
                }
            }).trigger("resize");

            function menuToggle() {
                $("nav.menu, ul").toggleClass('responsive', '');
            }
        </script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
