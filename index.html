<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Some tips and notes need to write here.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Yao He's Awesome Site</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="https://stephen0921.github.io/">
<link rel="next" href="index-3.html" type="text/html">
<!--[if lt IE 9]>
            <script src="assets/js/html5shiv.min.js"></script>
            <script src="assets/js/respond.min.js"></script>
        <![endif]--><link rel="prefetch" href="posts/test/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar  header-panel shadow-z-3" role="navigation"><div class="container-fluid">
        <div class="row">
          <div class="col-xs-3">
            <h1 class="title-blog">
                <a href="https://stephen0921.github.io/">
                        <span id="blog-title">Yao He's Awesome Site</span>
                    </a>
            </h1>
          </div>
          <div class="col-xs-9">
            <a id="hamburger" class="btn btn-raised" href="javascript:void(0);" onclick="menuToggle();">☰</a>
          </div>
        </div>
      </div>
<!-- /.container-fluid -->
</nav><div class="container-fluid main" id="content" role="main">
        <div class="row">
            <nav class="col-xs-12 col-sm-3 menu"><ul>
<li class="withripple"><a href="archive.html">Archive</a></li>
                <li class="withripple"><a href="categories/">Tags</a></li>
                <li class="withripple"><a href="rss.xml">RSS feed</a></li>

                    
                </ul>
<ul></ul></nav><div class="posts-material col-xs-12 col-sm-9">
                <div class="col-xs-12 col-md-11 content-material">

    <div class="postindex well post-material ">
    
        <article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/test/" class="u-url">I am back</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/test/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2018-07-15T19:14:08+08:00" title="2018-07-15 19:14">2018-07-15 19:14</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
Long time no see.
</p>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/install-perl-module-without-root-priviledge/" class="u-url">Install Perl Module without Root Priviledge</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/install-perl-module-without-root-priviledge/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2018-02-21T19:14:08+08:00" title="2018-02-21 19:14">2018-02-21 19:14</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
当没有root权限但是又想要安装一个module的时候，可以通过编译module源码的方式来实现.
比如我想要安装template-toolkit, 那么我就去<a href="http://www.template-toolkit.org/download/index.html">官网</a> 下载源码.
然后在terminal中依次执行以下命令.
</p>
<div class="highlight"><pre><span></span>$ tar zxf Template-Toolkit-2.26.tar.gz
$ <span class="nb">cd</span> Template-Toolkit-2.26
$ perl Makefile.PL <span class="nv">PREFIX</span><span class="o">=</span>/Users/user/test/local/perl
$ make
$ make <span class="nb">test</span>
$ make install
</pre></div>

<p>
然后在自己的perl文件中，加上一条:
</p>
<div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">lib</span> <span class="s">"/Users/user/test/local/perl/lib/perl5/site_perl/5.18.2/darwin-thread-multi-2level"</span><span class="p">;</span>
</pre></div>

<p>
这样就可以使用我们新安装的module了。
</p>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/autoinst/" class="u-url">Autoinst</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/autoinst/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2018-02-03T15:57:16+08:00" title="2018-02-03 15:57">2018-02-03 15:57</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
verilog中的模块例化等快捷操作，在Emacs中的verilog-mode下，非常强大和方便。让非Emacs用户也可以享受到它的便利，需要做一下小小的包装。这个包装脚本很简单，等下周一给同事们推广一下，看看效果反馈。
</p>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/hello-2018/" class="u-url">hello, 2018</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/hello-2018/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2018-01-27T11:09:33+08:00" title="2018-01-27 11:09">2018-01-27 11:09</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
转眼2018年了，也不知道要写点啥了.
</p>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-12-09-tmux-part3/" class="u-url">Tmux Introduction III</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-12-09-tmux-part3/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-12-09T11:32:32+08:00" title="2017-12-09 11:32">2017-12-09 11:32</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
结合到自己的工作流程中.
比如我有一个shell脚本针对我的某一个项目的工作, 它帮我预先配置好环境.
</p>
<div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>
<span class="c1"># 判断后台是否已经有名为bba的session</span>
tmux has-session -t bba
<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">]</span>
<span class="c1"># 如果没有, 那么建立这个session</span>
<span class="k">then</span>
  <span class="c1"># 建立一个名为bba的session, 同时window名为editor</span>
  tmux new-session -s bba -n editor -d
  <span class="c1"># 预先输入一组命令, 提供工作效率, C-m表示回车键</span>
  tmux send-keys -t bba <span class="s1">'newgrp kobra'</span> C-m
  tmux send-keys -t bba <span class="s1">'cd /vobs/fpga/cobra'</span> C-m
  tmux send-keys -t bba <span class="s1">'ct setview ezyaohe_1'</span> C-m
  tmux send-keys -t bba <span class="s1">'module add cobra/3.1'</span> C-m
  tmux send-keys -t bba <span class="s1">'emacs'</span> C-m
  <span class="c1"># 竖直拆分成2个panes</span>
  tmux split-window -v -t bba
  <span class="c1"># 选择一个布局样式</span>
  tmux <span class="k">select</span>-layout -t bba main-horizontal
  <span class="c1"># 向第二个pane里输入一组命令，类似于上面的</span>
  tmux send-keys -t bba:1.2 <span class="s1">'newgrp kobra'</span> C-m
  tmux send-keys -t bba:1.2 <span class="s1">'cd /vobs/fpga/cobra'</span> C-m
  tmux send-keys -t bba:1.2 <span class="s1">'ct setview ezyaohe_1'</span> C-m
  tmux send-keys -t bba:1.2 <span class="s1">'module add cobra/3.1'</span> C-m
  <span class="c1"># 新开一个window，名为console</span>
  tmux new-window -n console -t bba
  <span class="c1"># 向第二个window中输入一组命令</span>
  tmux send-keys -t bba:2 <span class="s1">'newgrp kobra'</span> C-m
  tmux send-keys -t bba:2 <span class="s1">'cd /vobs/fpga/cobra'</span> C-m
  tmux send-keys -t bba:2 <span class="s1">'ct setview ezyaohe_1'</span> C-m
  tmux send-keys -t bba:2 <span class="s1">'module add cobra/3.1'</span> C-m
  tmux send-keys -t bba:2 <span class="s1">'cd /proj/cobra/verif/ezyaohe'</span> C-m
  <span class="c1"># 光标回到第一个window</span>
  tmux <span class="k">select</span>-window -t bba:1
<span class="k">fi</span>
<span class="c1"># 连接bba这个session</span>
tmux attach -t bba
</pre></div>

<div class="HTML">
<p>
&lt;img src="../../images/tmuxworkflow.png" class="img-thumbnail" width="90%" &gt;
</p>

</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-12-09-tmux-part2/" class="u-url">Tmux Introduction II</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-12-09-tmux-part2/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-12-09T11:11:32+08:00" title="2017-12-09 11:11">2017-12-09 11:11</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
定制我们的Tmux.
</p>

<p>
启动Tmux时，会自动去source ~/.tmux.conf文件. 
</p>

<p>
先来看看我的.tmux.conf文件内容.
</p>

<div class="highlight"><pre><span></span><span class="c1"># It is for tmux-2.4</span>
<span class="c1"># Set the base index for windows to 1 instead of 0</span>
<span class="nb">set</span> -g base-index <span class="m">1</span>
<span class="c1"># Set the base index for panes to 1 instead of 0</span>
setw -g pane-base-index <span class="m">1</span>
<span class="c1"># Reload the file with Prefix r</span>
<span class="nb">bind</span> r source-file ~/.tmux.conf <span class="se">\;</span> display <span class="s2">"Reloaded!"</span>
<span class="c1"># splitting panes</span>
<span class="nb">bind</span> <span class="p">|</span> split-window -h
<span class="nb">bind</span> - split-window -v
<span class="c1"># moving between panes</span>
<span class="nb">bind</span> h <span class="k">select</span>-pane -L
<span class="nb">bind</span> j <span class="k">select</span>-pane -D
<span class="nb">bind</span> k <span class="k">select</span>-pane -U
<span class="nb">bind</span> l <span class="k">select</span>-pane -R
<span class="c1"># Pane resizing</span>
<span class="nb">bind</span> -r H resize-pane -L <span class="m">2</span>
<span class="nb">bind</span> -r J resize-pane -D <span class="m">2</span>
<span class="nb">bind</span> -r K resize-pane -U <span class="m">2</span>
<span class="nb">bind</span> -r L resize-pane -R <span class="m">2</span>
<span class="c1"># Set the default terminal mode to 256color mode</span>
<span class="nb">set</span> -g default-terminal <span class="s2">"screen-256color"</span>
<span class="c1"># set the status line's colors</span>
<span class="nb">set</span> -g status-fg white
<span class="nb">set</span> -g status-bg black
<span class="c1"># set the color of the window list</span>
setw -g window-status-fg cyan
setw -g window-status-bg default
setw -g window-status-attr dim
<span class="c1"># set colors for the active window</span>
setw -g window-status-current-fg white
setw -g window-status-current-bg red
setw -g window-status-current-attr bright
<span class="c1"># pane colors</span>
<span class="nb">set</span> -g pane-border-fg green
<span class="nb">set</span> -g pane-border-bg black
<span class="nb">set</span> -g pane-active-border-fg white
<span class="nb">set</span> -g pane-active-border-bg yellow
<span class="c1"># Command / message line</span>
<span class="nb">set</span> -g message-fg white
<span class="nb">set</span> -g message-bg black
<span class="nb">set</span> -g message-attr bright
<span class="c1"># Status line left side</span>
<span class="nb">set</span> -g status-left-length <span class="m">40</span>
<span class="nb">set</span> -g status-left <span class="s2">"#[fg=green]Session: #S #[fg=yellow]#I #[fg=cyan]#P"</span>
<span class="c1"># Update the status bar every sixty seconds</span>
<span class="nb">set</span> -g status-interval <span class="m">60</span>
<span class="c1"># Center the window list</span>
<span class="nb">set</span> -g status-justify centre
<span class="c1"># Mouse support</span>
set-option -g mouse on
<span class="c1"># Move like vi</span>
setw -g mode-keys vi
</pre></div>

<p>
上一篇介绍提到buffer模式中的移动以及复制, 当我们用命令"setw -g mode-keys vi"时，我们在buffer模式移动时就和vi一样了, 比如"gg"到buffer首端, "G"到buffer末端, 空格开始选择要copy的部分, 回车退出copy部分的选择, "prefix ]"是黏贴.
</p>

<p>
调整好了再看看tmux的样式.
</p>

<div class="HTML">
<p>
&lt;img src="../../images/tmuxconf.png" class="img-thumbnail" width="90%" &gt;
</p>

</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-12-06-tmux-part1/" class="u-url">Tmux Introduction I</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-12-06-tmux-part1/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-12-06T22:35:32+08:00" title="2017-12-06 22:35">2017-12-06 22:35</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-org53f476c" class="outline-2">
<h2 id="org53f476c">什么是Tmux?</h2>
<div class="outline-text-2" id="text-org53f476c">
<p>
Tmux可以理解为是一个terminal控制器, 是对我们的terminal的扩展, 同时我们可以利用它来建立自己的一套workflow.
</p>

<p>
先上一张图,感受一下.
</p>

<div class="HTML">
<p>
&lt;img src="../../images/tmux.png" class="img-thumbnail" width="90%" &gt;
</p>

</div>

<p>
Terminal的上半部分是打开了vim准备编辑, 下半部分竖直拆分成2个部分.
</p>
</div>
</div>

<div id="outline-container-orga23646f" class="outline-2">
<h2 id="orga23646f">为什么要用Tmux?</h2>
<div class="outline-text-2" id="text-orga23646f">
<p>
原因一, 在一个Terminal上实现了多窗口控制,便于写代码同时调试;
</p>

<p>
原因二, Tmux为我们在后台保存了一个进程, 记录了我们当前的窗口状态, 即使关闭这个Terminal, 只要下次再打开Tmux,立刻恢复退出前的状态.
</p>

<p>
原因三, 我们可以给Tmux提供一组配置文件, 这样可以在每次建立窗口前, 预先设置好环境, 提高了工作效率.
</p>
</div>
</div>

<div id="outline-container-org05bf749" class="outline-2">
<h2 id="org05bf749">怎么用Tmux?</h2>
<div class="outline-text-2" id="text-org05bf749">
<p>
首先,先建立一个Tmux进程, 这里有专门的术语session.
</p>

<div class="highlight"><pre><span></span>tmux new -s abc
</pre></div>

<p>
我们通过上面的命令得到了一个Tmux session,名字叫abc.
</p>

<div class="HTML">
<p>
&lt;img src="../../images/newsession.png" class="img-thumbnail" width="90%" &gt;          
</p>

</div>

<p>
这个时候Terminal底部的绿色状态栏提示我们,目前是在一个Tmux的session中.现在我们就可以做一些分割窗口的操作了.Tmux的所有命令都有同样的一个前缀,就是"ctrl-b"<sup><a id="fnr.1" class="footref" href="posts/2017-12-06-tmux-part1/#fn.1">1</a></sup>. 我们按"ctrl-b", 然后按"%", 为了便于说明我用"prefix %"来表示. Terminal就被竖直分成了两个部分.这每一部分称为pane.在pane之间来回移动光标的命令是"prefix o"<sup><a id="fnr.2" class="footref" href="posts/2017-12-06-tmux-part1/#fn.2">2</a></sup>.
</p>

<div class="HTML">
<p>
&lt;img src="../../images/split.png" class="img-thumbnail" width="90%" &gt;          
</p>

</div>

<p>
我们先断开session连接, 命令是"prefix d".
</p>

<p>
然后在terminal中输入命令，来查看后台有哪些Tmux的session.
</p>

<div class="highlight"><pre><span></span>tmux ls
</pre></div>

<p>
结果显示如下, 有一个Tmux后台进程, session名为abc.
</p>
<div class="HTML">
<p>
&lt;img src="../../images/tmuxls.png" class="img-thumbnail" width="90%" &gt;          
</p>

</div>

<p>
我们再通过下面的命令,重新连接到session abc去.
</p>

<div class="highlight"><pre><span></span>tmux attach -t abc
</pre></div>
</div>
</div>

<div id="outline-container-org720a7e9" class="outline-2">
<h2 id="org720a7e9">window概念</h2>
<div class="outline-text-2" id="text-org720a7e9">
<p>
连接或者新打开一个session, 我们就得到了一个window. window可以被拆成若干pane.
新建一个window的快捷键是"prefix c", 关闭一个window的快捷键是"prefix &amp;".
</p>
</div>
</div>

<div id="outline-container-orgd5e3c0c" class="outline-2">
<h2 id="orgd5e3c0c">buffer概念</h2>
<div class="outline-text-2" id="text-orgd5e3c0c">
<p>
当我们想copy terminal显示的内容时, 我们需要进入buffer模式, 快捷键是"prefix [".
</p>

<p>
在buffer中移动以及其他操作我们留在下一篇介绍里说.
</p>

<p>
在非buffer模式, 如果想paste内容, 快捷键是"prefix ]".
</p>

<div class="HTML">
<p>
&lt;img src="../../images/tmuxbuf.png" class="img-thumbnail" width="90%" &gt;   
</p>

</div>

<p>
注意右上脚的行号显示, 表示我们现在是buffer模式. (按"q"退出buffer模式)
</p>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef">
<sup><a id="fn.1" class="footnum" href="posts/2017-12-06-tmux-part1/#fnr.1">1</a></sup><div class="footpara"><p class="footpara">
"-"表示两个键同时按.
</p></div>
</div>

<div class="footdef">
<sup><a id="fn.2" class="footnum" href="posts/2017-12-06-tmux-part1/#fnr.2">2</a></sup><div class="footpara"><p class="footpara">
" "表示按键依次按.
</p></div>
</div>


</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-10-31-emacs-rectangle/" class="u-url">Emacs column edit</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-10-31-emacs-rectangle/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-10-31T18:35:32+08:00" title="2017-10-31 18:35">2017-10-31 18:35</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <p>
以前一直觉得emacs的列操作不如vim好用，经过最近一段时间的深入使用，让我的看法有所改变。比如下面的代码我想多加4组agent，那么怎么做呢？
</p>
<div class="highlight"><pre><span></span>agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));
</pre></div>
<p>
先copy四行出来。
</p>
<div class="highlight"><pre><span></span>agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));

// the 4 lines below are copied from above
agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));
</pre></div>
<p>
然后，先选中要修改的4行，然后M-C-%(或者M-x，键入query-replace-regexp, 回车)，在mini-buffer中输入被替换的表达式是
</p>
<div class="highlight"><pre><span></span><span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>+
</pre></div>
<p>
目标表达式是 
</p>
<div class="highlight"><pre><span></span><span class="se">\,</span> <span class="o">(</span>+ <span class="m">4</span> <span class="se">\#</span><span class="p">&amp;</span><span class="o">)</span>
</pre></div>
<p>
然后回车，就有一个交互式提示，想要替换掉的，按y，不想替换的按n，如果想全部替换的话，按！,具体命令可以按？来查询。
如图所示。
</p>

<div class="HTML">
<p>
&lt;img src="../../images/emacs.PNG" class="img-thumbnail" width="60%" &gt;          
</p>

</div>

<p>
经过4轮的"yynn"后就得到了下面的代码。
</p>
<div class="highlight"><pre><span></span>agent0 u_agent_0(.clk1(clk),.rst1(rst));
agent1 u_agent_1(.clk1(clk),.rst1(rst));
agent2 u_agent_2(.clk1(clk),.rst1(rst));
agent3 u_agent_3(.clk1(clk),.rst1(rst));

// the 4 lines below are copied from above, then replace
agent4 u_agent_4(.clk1(clk),.rst1(rst));
agent5 u_agent_5(.clk1(clk),.rst1(rst));
agent6 u_agent_6(.clk1(clk),.rst1(rst));
agent7 u_agent_7(.clk1(clk),.rst1(rst));
</pre></div>
<p>
这个过程略显复杂，如果是emacs版本25.2的话，就可以使用(rectangle-mark-mode)来单独选中要改变的列，然后整体替换就ok了。
如下图所示。
</p>
<div class="HTML">
<p>
&lt;img src="../../images/emacs-rect.PNG" class="img-thumbnail" width="60%" &gt;
</p>

</div>
<div class="HTML">
<p>
&lt;img src="../../images/emacs-rect-2.PNG" class="img-thumbnail" width="60%" &gt;
</p>

</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-09-22-openxmlformat/" class="u-url">Use Openxmlformat to Generate WORD DOC</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-09-22-openxmlformat/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-09-22T11:55:32+08:00" title="2017-09-22 11:55">2017-09-22 11:55</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-org3314c38" class="outline-2">
<h2 id="org3314c38">Generating MS-WORD doc using openxmlformat</h2>
<div class="outline-text-2" id="text-org3314c38">
<p>
使用openxmlformat格式来描述，可以用WORD打开的xml文档。
</p>
</div>
</div>
        </div>
        </article><article class="h-entry post-text"><header><h1 class="p-name entry-title header"><a href="posts/2017-09-12-emacs-tags-verdi/" class="u-url">Generate Tags for Emacs by Verdi</a></h1>
            <div class="metadata">
                <span class="byline author vcard">
                        <i class="mdi-action-face-unlock"></i>
                    Yao He
                </span>
                <span class="dateline"><a href="posts/2017-09-12-emacs-tags-verdi/" rel="bookmark">
                    <i class="mdi-device-access-time"></i><time class="published dt-published" datetime="2017-09-12T10:35:32+08:00" title="2017-09-12 10:35">2017-09-12 10:35</time></a></span>
            </div>
            <hr></header><div class="e-content entry-content">
        <div id="outline-container-org9fd8f90" class="outline-2">
<h2 id="org9fd8f90">Generate Tags for Emacs by Verdi</h2>
<div class="outline-text-2" id="text-org9fd8f90">
<p>
无意中看到SNUG的一个文章，作者通过使用Verdi来生成Emacs以及Vim的tags文件，很棒。我一直没有找到特别好的办法来用Emacs浏览verilog 代码工程，之前也是使用Emacs的插件projectile来grep关键字。我赶紧按照作者的描述操作起来了。
</p>

<div class="HTML">
<p>
&lt;img src="../../images/tags.png" class="img-thumbnail" width="60%" &gt;
</p>

</div>

<p>
作者的tcl脚本是放在<a href="https://www.vc-apps.org/sitepages/downloadList.aspx">这里的</a> ，居然排在第一个。
</p>

<div class="HTML">
<p>
&lt;img src="../../images/vcc.PNG" class="img-thumbnail" width="60%" &gt;
</p>

</div>

<p>
在Verdi打开tcl命令窗口，然后source下载的tcl脚本。
</p>

<div class="HTML">
<p>
&lt;img src="../../images/verdi.PNG" class="img-thumbnail" width="60%" &gt;
</p>

</div>

<p>
生成的vim版本的tags文件是ok的，能用。Emacs版本的TAGS文件居然不能跳转！
</p>

<p>
仔细查了一遍，应该是作者把emacs tags文件的格式弄错了，看来作者一定是vim用户了，或者我使用的emacs版本（25.2）太高了？
</p>

<p>
再看了一遍论文，作者文字描述的格式和他实际脚本生成的TAGS格式不一致，把tag_definition_text丢掉了，所以跳转有问题。
</p>

<div class="HTML">
<p>
&lt;img src="../../images/emacs_tags_format.png" class="img-thumbnail" width="60%" &gt;
</p>

</div>

<p>
去<a href="https://www.vc-apps.org/sitepages/gettingstarted.aspx">官网</a>查到了npi参考手册，fix一下tcl代码。
</p>

<div class="highlight"><pre><span></span>  <span class="k">foreach</span> <span class="k">{</span><span class="nv">index</span> tagInfo<span class="k">}</span> <span class="nv">$sorted_ident</span> <span class="k">{</span>
    <span class="k">set</span> srcFile <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$tagInfo</span><span class="k">]</span> <span class="mi">1</span><span class="k">]</span>
    <span class="k">if</span> <span class="k">{</span><span class="nv">$fileName</span> <span class="o">==</span> <span class="nv">$srcFile</span><span class="k">}</span> <span class="k">{</span>
      <span class="k">set</span> tag <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$tagInfo</span><span class="k">]</span> <span class="mi">0</span><span class="k">]</span>
      <span class="k">set</span> line <span class="k">[</span><span class="nb">lindex</span> <span class="k">[</span><span class="nb">split</span> <span class="nv">$tagInfo</span><span class="k">]</span> <span class="mi">2</span><span class="k">]</span>
      <span class="k">set</span> offset <span class="nv">$byteCounts</span><span class="k">(</span><span class="nv">$line</span><span class="k">)</span>

      <span class="c">#======= fix by yaohe begin ===========#</span>
	<span class="c">#set entry "\x7f$tag\x01,$offset"</span>
	<span class="k">set</span> file_hdl <span class="k">[</span><span class="nv">npi_text_file_by_name</span> <span class="o">-</span>name <span class="s2">"$srcFile"</span><span class="k">]</span>
	<span class="k">set</span> line_hdl <span class="k">[</span><span class="nv">npi_text_line_by_number</span> <span class="o">-</span>ref <span class="nv">$file_hdl</span> <span class="o">-</span>number <span class="nv">$line</span><span class="k">]</span>
	<span class="k">set</span> line_content <span class="k">[</span><span class="nv">npi_text_property_str</span> <span class="o">-</span>type npiTextLineContent <span class="o">-</span>ref <span class="nv">$line_hdl</span><span class="k">]</span>
	<span class="nb">regsub</span> <span class="k">{</span><span class="err">\</span><span class="nv">n</span><span class="err">$</span><span class="k">}</span> <span class="nv">$line_content</span> <span class="k">{}</span> line_content
	<span class="k">set</span> entry <span class="s2">"$line_content\x7f$line,$offset"</span>
      <span class="c">#======= fix by yaohe end ===========#</span>

      <span class="nb">append</span> entryList <span class="s2">"\n"</span> <span class="nv">$entry</span>
    <span class="k">}</span>
  <span class="k">}</span>
</pre></div>

<p>
终于好用了。
</p>

<div class="HTML">
<p>
&lt;img src="../../images/emacs_tags_ok.png" class="img-thumbnail" width="60%" &gt;
</p>

</div>

<p>
新的tcl代码我备份我的<a href="https://github.com/stephen0921/GenEmacsTagsByVerdi">github</a>上，因为实在联系不上作者。
</p>
</div>
</div>
        </div>
        </article>
</div>
        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-3.html" rel="next">Older posts</a>
            </li>
        </ul></nav>
</div>
            </div>
        </div>
        <button class="btn btn-fab btn-raised btn-material-green btn-footer" data-toggle="modal" data-target="#footer-dialog">
            <i class="mdi-communication-message"></i>
        </button>
        <div id="footer-dialog" class="modal fade" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Yao He's Awesome Site credits</h4>
              </div>
              <div class="modal-body">
                    Contents © 2018         <a href="mailto:stephen0921@gmail.com">Yao He</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
              </div>
              <div class="modal-footer">
                <button class="btn btn-primary" data-dismiss="modal">Ok</button>
              </div>
            </div>
          </div>
        </div>
        <div class="source-button">
        </div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>

            $(document).ready(function() {
                // This command is used to initialize some elements and make them work properly
                $.material.init();
            });

            $(window).on("resize", function() {
                if($(window).width() > 767) {
                  $("html, body").height($(window).height());
                  $(".main, .menu").height($(window).height() - $(".header-panel").outerHeight() - 76 );
                  $(".posts-material").height($(window).height());
                } else {
                  $("html, body").css('height', '');
                  $(".main, .menu").css('height', '');
                  $(".posts-material").css('height', '');
                }
            }).trigger("resize");

            function menuToggle() {
                $("nav.menu, ul").toggleClass('responsive', '');
            }
        </script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
